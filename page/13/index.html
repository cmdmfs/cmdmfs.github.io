<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.8.0" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.8.0" type="image/png" sizes="32x32"><meta name="description" content="have a try try">
<meta property="og:type" content="website">
<meta property="og:title" content="汪汪队">
<meta property="og:url" content="http://example.com/page/13/index.html">
<meta property="og:site_name" content="汪汪队">
<meta property="og:description" content="have a try try">
<meta property="og:locale">
<meta property="article:author" content="汪汪队">
<meta name="twitter:card" content="summary"><title>汪汪队</title><link ref="canonical" href="http://example.com/page/13/index.html"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.8.0"><link rel="stylesheet" href="css/custom.css"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"Copy","copySuccess":"Copy Success","copyError":"Copy Error"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">Home</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">Archives</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">Hello Stun</div><div class="header-banner-info__subtitle">An elegant theme for Hexo</div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content content-home" id="content"><section class="postlist"><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/03/24/02_%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/01_%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8-demo/node_modules/aws4/README/">[ Untitled ]</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2023-03-24</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">1985-10-26</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h2 id="aws4"   >
          <a href="#aws4" class="heading-link"><i class="fas fa-link"></i></a><a href="#aws4" class="headerlink" title="aws4"></a>aws4</h2>
      <p><a target="_blank" rel="noopener" href="https://travis-ci.org/github/mhart/aws4"><img   src="https://api.travis-ci.org/mhart/aws4.png?branch=master" style=""  alt="Build Status"></a></p>
<p>A small utility to sign vanilla Node.js http(s) request options using Amazon’s<br><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://docs.aws.amazon.com/general/latest/gr/signature-version-4.html" >AWS Signature Version 4</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>.</p>
<p>If you want to sign and send AWS requests in a modern browser, or an environment like <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://developers.cloudflare.com/workers/" >Cloudflare Workers</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>, then check out <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/mhart/aws4fetch" >aws4fetch</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> – otherwise you can also bundle this library for use <a href="./browser">in older browsers</a>.</p>
<p>The only AWS service that <em>doesn’t</em> support v4 as of 2020-05-22 is<br><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://docs.aws.amazon.com/AmazonSimpleDB/latest/DeveloperGuide/SDB_API.html" >SimpleDB</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><br>(it only supports <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/mhart/aws2" >AWS Signature Version 2</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>).</p>
<p>It also provides defaults for a number of core AWS headers and<br>request parameters, making it very easy to query AWS services, or<br>build out a fully-featured AWS library.</p>

        <h2 id="Example"   >
          <a href="#Example" class="heading-link"><i class="fas fa-link"></i></a><a href="#Example" class="headerlink" title="Example"></a>Example</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> https = <span class="built_in">require</span>(<span class="string">&#x27;https&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> aws4  = <span class="built_in">require</span>(<span class="string">&#x27;aws4&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// to illustrate usage, we&#x27;ll create a utility function to request and pipe to stdout</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">request</span>(<span class="params">opts</span>) &#123; https.<span class="title function_">request</span>(opts, <span class="keyword">function</span>(<span class="params">res</span>) &#123; res.<span class="title function_">pipe</span>(process.<span class="property">stdout</span>) &#125;).<span class="title function_">end</span>(opts.<span class="property">body</span> || <span class="string">&#x27;&#x27;</span>) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// aws4 will sign an options object as you&#x27;d pass to http.request, with an AWS service and region</span></span><br><span class="line"><span class="keyword">var</span> opts = &#123; <span class="attr">host</span>: <span class="string">&#x27;my-bucket.s3.us-west-1.amazonaws.com&#x27;</span>, <span class="attr">path</span>: <span class="string">&#x27;/my-object&#x27;</span>, <span class="attr">service</span>: <span class="string">&#x27;s3&#x27;</span>, <span class="attr">region</span>: <span class="string">&#x27;us-west-1&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// aws4.sign() will sign and modify these options, ready to pass to http.request</span></span><br><span class="line">aws4.<span class="title function_">sign</span>(opts, &#123; <span class="attr">accessKeyId</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">secretAccessKey</span>: <span class="string">&#x27;&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// or it can get credentials from process.env.AWS_ACCESS_KEY_ID, etc</span></span><br><span class="line">aws4.<span class="title function_">sign</span>(opts)</span><br><span class="line"></span><br><span class="line"><span class="comment">// for most AWS services, aws4 can figure out the service and region if you pass a host</span></span><br><span class="line">opts = &#123; <span class="attr">host</span>: <span class="string">&#x27;my-bucket.s3.us-west-1.amazonaws.com&#x27;</span>, <span class="attr">path</span>: <span class="string">&#x27;/my-object&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// usually it will add/modify request headers, but you can also sign the query:</span></span><br><span class="line">opts = &#123; <span class="attr">host</span>: <span class="string">&#x27;my-bucket.s3.amazonaws.com&#x27;</span>, <span class="attr">path</span>: <span class="string">&#x27;/?X-Amz-Expires=12345&#x27;</span>, <span class="attr">signQuery</span>: <span class="literal">true</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// and for services with simple hosts, aws4 can infer the host from service and region:</span></span><br><span class="line">opts = &#123; <span class="attr">service</span>: <span class="string">&#x27;sqs&#x27;</span>, <span class="attr">region</span>: <span class="string">&#x27;us-east-1&#x27;</span>, <span class="attr">path</span>: <span class="string">&#x27;/?Action=ListQueues&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// and if you&#x27;re using us-east-1, it&#x27;s the default:</span></span><br><span class="line">opts = &#123; <span class="attr">service</span>: <span class="string">&#x27;sqs&#x27;</span>, <span class="attr">path</span>: <span class="string">&#x27;/?Action=ListQueues&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line">aws4.<span class="title function_">sign</span>(opts)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(opts)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">  host: &#x27;sqs.us-east-1.amazonaws.com&#x27;,</span></span><br><span class="line"><span class="comment">  path: &#x27;/?Action=ListQueues&#x27;,</span></span><br><span class="line"><span class="comment">  headers: &#123;</span></span><br><span class="line"><span class="comment">    Host: &#x27;sqs.us-east-1.amazonaws.com&#x27;,</span></span><br><span class="line"><span class="comment">    &#x27;X-Amz-Date&#x27;: &#x27;20121226T061030Z&#x27;,</span></span><br><span class="line"><span class="comment">    Authorization: &#x27;AWS4-HMAC-SHA256 Credential=ABCDEF/20121226/us-east-1/sqs/aws4_request, ...&#x27;</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// we can now use this to query AWS</span></span><br><span class="line"><span class="title function_">request</span>(opts)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="comment">&lt;ListQueuesResponse xmlns=&quot;https://queue.amazonaws.com/doc/2012-11-05/&quot;&gt;</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// aws4 can infer the HTTP method if a body is passed in</span></span><br><span class="line"><span class="comment">// method will be POST and Content-Type: &#x27;application/x-www-form-urlencoded; charset=utf-8&#x27;</span></span><br><span class="line"><span class="title function_">request</span>(aws4.<span class="title function_">sign</span>(&#123; <span class="attr">service</span>: <span class="string">&#x27;iam&#x27;</span>, <span class="attr">body</span>: <span class="string">&#x27;Action=ListGroups&amp;Version=2010-05-08&#x27;</span> &#125;))</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&lt;ListGroupsResponse xmlns=&quot;https://iam.amazonaws.com/doc/2010-05-08/&quot;&gt;</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// you can specify any custom option or header as per usual</span></span><br><span class="line"><span class="title function_">request</span>(aws4.<span class="title function_">sign</span>(&#123;</span><br><span class="line">  <span class="attr">service</span>: <span class="string">&#x27;dynamodb&#x27;</span>,</span><br><span class="line">  <span class="attr">region</span>: <span class="string">&#x27;ap-southeast-2&#x27;</span>,</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  <span class="attr">headers</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-amz-json-1.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;X-Amz-Target&#x27;</span>: <span class="string">&#x27;DynamoDB_20120810.ListTables&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">body</span>: <span class="string">&#x27;&#123;&#125;&#x27;</span></span><br><span class="line">&#125;))</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&#123;&quot;TableNames&quot;:[]&#125;</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// The raw RequestSigner can be used to generate CodeCommit Git passwords</span></span><br><span class="line"><span class="keyword">var</span> signer = <span class="keyword">new</span> aws4.<span class="title class_">RequestSigner</span>(&#123;</span><br><span class="line">  <span class="attr">service</span>: <span class="string">&#x27;codecommit&#x27;</span>,</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;git-codecommit.us-east-1.amazonaws.com&#x27;</span>,</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&#x27;GIT&#x27;</span>,</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/v1/repos/MyAwesomeRepo&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">var</span> password = signer.<span class="title function_">getDateTime</span>() + <span class="string">&#x27;Z&#x27;</span> + signer.<span class="title function_">signature</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// see example.js for examples with other services</span></span><br></pre></td></tr></table></div></figure>


        <h2 id="API"   >
          <a href="#API" class="heading-link"><i class="fas fa-link"></i></a><a href="#API" class="headerlink" title="API"></a>API</h2>
      
        <h3 id="aws4-sign-requestOptions-credentials"   >
          <a href="#aws4-sign-requestOptions-credentials" class="heading-link"><i class="fas fa-link"></i></a><a href="#aws4-sign-requestOptions-credentials" class="headerlink" title="aws4.sign(requestOptions, [credentials])"></a>aws4.sign(requestOptions, [credentials])</h3>
      <p>Calculates and populates any necessary AWS headers and&#x2F;or request<br>options on <code>requestOptions</code>. Returns <code>requestOptions</code> as a convenience for chaining.</p>
<p><code>requestOptions</code> is an object holding the same options that the Node.js<br><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://nodejs.org/docs/latest/api/http.html#http_http_request_options_callback" >http.request</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><br>function takes.</p>
<p>The following properties of <code>requestOptions</code> are used in the signing or<br>populated if they don’t already exist:</p>
<ul>
<li><code>hostname</code> or <code>host</code> (will try to be determined from <code>service</code> and <code>region</code> if not given)</li>
<li><code>method</code> (will use <code>&#39;GET&#39;</code> if not given or <code>&#39;POST&#39;</code> if there is a <code>body</code>)</li>
<li><code>path</code> (will use <code>&#39;/&#39;</code> if not given)</li>
<li><code>body</code> (will use <code>&#39;&#39;</code> if not given)</li>
<li><code>service</code> (will try to be calculated from <code>hostname</code> or <code>host</code> if not given)</li>
<li><code>region</code> (will try to be calculated from <code>hostname</code> or <code>host</code> or use <code>&#39;us-east-1&#39;</code> if not given)</li>
<li><code>signQuery</code> (to sign the query instead of adding an <code>Authorization</code> header, defaults to false)</li>
<li><code>headers[&#39;Host&#39;]</code> (will use <code>hostname</code> or <code>host</code> or be calculated if not given)</li>
<li><code>headers[&#39;Content-Type&#39;]</code> (will use <code>&#39;application/x-www-form-urlencoded; charset=utf-8&#39;</code><br>if not given and there is a <code>body</code>)</li>
<li><code>headers[&#39;Date&#39;]</code> (used to calculate the signature date if given, otherwise <code>new Date</code> is used)</li>
</ul>
<p>Your AWS credentials (which can be found in your<br><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://portal.aws.amazon.com/gp/aws/securityCredentials" >AWS console</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>)<br>can be specified in one of two ways:</p>
<ul>
<li>As the second argument, like this:</li>
</ul>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">aws4.<span class="title function_">sign</span>(requestOptions, &#123;</span><br><span class="line">  <span class="attr">secretAccessKey</span>: <span class="string">&quot;&lt;your-secret-access-key&gt;&quot;</span>,</span><br><span class="line">  <span class="attr">accessKeyId</span>: <span class="string">&quot;&lt;your-access-key-id&gt;&quot;</span>,</span><br><span class="line">  <span class="attr">sessionToken</span>: <span class="string">&quot;&lt;your-session-token&gt;&quot;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></div></figure>

<ul>
<li>From <code>process.env</code>, such as this:</li>
</ul>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export AWS_ACCESS_KEY_ID=&quot;&lt;your-access-key-id&gt;&quot;</span><br><span class="line">export AWS_SECRET_ACCESS_KEY=&quot;&lt;your-secret-access-key&gt;&quot;</span><br><span class="line">export AWS_SESSION_TOKEN=&quot;&lt;your-session-token&gt;&quot;</span><br></pre></td></tr></table></div></figure>

<p>(will also use <code>AWS_ACCESS_KEY</code> and <code>AWS_SECRET_KEY</code> if available)</p>
<p>The <code>sessionToken</code> property and <code>AWS_SESSION_TOKEN</code> environment variable are optional for signing<br>with <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp_use-resources.html" >IAM STS temporary credentials</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>.</p>

        <h2 id="Installation"   >
          <a href="#Installation" class="heading-link"><i class="fas fa-link"></i></a><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2>
      <p>With <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.npmjs.com/" >npm</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> do:</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install aws4</span><br></pre></td></tr></table></div></figure>

<p>Can also be used <a href="./browser">in the browser</a>.</p>

        <h2 id="Thanks"   >
          <a href="#Thanks" class="heading-link"><i class="fas fa-link"></i></a><a href="#Thanks" class="headerlink" title="Thanks"></a>Thanks</h2>
      <p>Thanks to <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/jed" >@jed</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> for his<br><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/jed/dynamo-client" >dynamo-client</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> lib where I first<br>committed and subsequently extracted this code.</p>
<p>Also thanks to the<br><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/aws/aws-sdk-js" >official Node.js AWS SDK</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> for giving<br>me a start on implementing the v4 signature.</p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/03/24/02_%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/01_%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8-demo/node_modules/aws-sign2/README/">[ Untitled ]</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2023-03-24</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2017-04-13</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="aws-sign"   >
          <a href="#aws-sign" class="heading-link"><i class="fas fa-link"></i></a><a href="#aws-sign" class="headerlink" title="aws-sign"></a>aws-sign</h1>
      <p>AWS signing. Originally pulled from LearnBoost&#x2F;knox, maintained as vendor in request, now a standalone module.</p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/03/24/02_%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/01_%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8-demo/node_modules/asynckit/README/">[ Untitled ]</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2023-03-24</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2016-06-15</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="asynckit"   >
          <a href="#asynckit" class="heading-link"><i class="fas fa-link"></i></a><a href="#asynckit" class="headerlink" title="asynckit "></a>asynckit <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/asynckit"><img   src="https://img.shields.io/npm/v/asynckit.svg?style=flat" style=""  alt="NPM Module"></a></h1>
      <p>Minimal async jobs utility library, with streams support.</p>
<p><a target="_blank" rel="noopener" href="https://travis-ci.org/alexindigo/asynckit"><img   src="https://img.shields.io/travis/alexindigo/asynckit/v0.4.0.svg?label=browser&style=flat" style=""  alt="PhantomJS Build"></a><br><a target="_blank" rel="noopener" href="https://travis-ci.org/alexindigo/asynckit"><img   src="https://img.shields.io/travis/alexindigo/asynckit/v0.4.0.svg?label=linux:0.12-6.x&style=flat" style=""  alt="Linux Build"></a><br><a target="_blank" rel="noopener" href="https://ci.appveyor.com/project/alexindigo/asynckit"><img   src="https://img.shields.io/appveyor/ci/alexindigo/asynckit/v0.4.0.svg?label=windows:0.12-6.x&style=flat" style=""  alt="Windows Build"></a></p>
<p><a target="_blank" rel="noopener" href="https://coveralls.io/github/alexindigo/asynckit?branch=master"><img   src="https://img.shields.io/coveralls/alexindigo/asynckit/v0.4.0.svg?label=code+coverage&style=flat" style=""  alt="Coverage Status"></a><br><a target="_blank" rel="noopener" href="https://david-dm.org/alexindigo/asynckit"><img   src="https://img.shields.io/david/alexindigo/asynckit/v0.4.0.svg?style=flat" style=""  alt="Dependency Status"></a><br><a target="_blank" rel="noopener" href="https://www.bithound.io/github/alexindigo/asynckit"><img src="https://www.bithound.io/github/alexindigo/asynckit/badges/score.svg" alt="bitHound Overall Score"></a></p>
<!-- [![Readme](https://img.shields.io/badge/readme-tested-brightgreen.svg?style=flat)](https://www.npmjs.com/package/reamde) -->

<p>AsyncKit provides harness for <code>parallel</code> and <code>serial</code> iterators over list of items represented by arrays or objects.<br>Optionally it accepts abort function (should be synchronously return by iterator for each item), and terminates left over jobs upon an error event. For specific iteration order built-in (<code>ascending</code> and <code>descending</code>) and custom sort helpers also supported, via <code>asynckit.serialOrdered</code> method.</p>
<p>It ensures async operations to keep behavior more stable and prevent <code>Maximum call stack size exceeded</code> errors, from sync iterators.</p>
<div class="table-container"><table>
<thead>
<tr>
<th align="left">compression</th>
<th align="right">size</th>
</tr>
</thead>
<tbody><tr>
<td align="left">asynckit.js</td>
<td align="right">12.34 kB</td>
</tr>
<tr>
<td align="left">asynckit.min.js</td>
<td align="right">4.11 kB</td>
</tr>
<tr>
<td align="left">asynckit.min.js.gz</td>
<td align="right">1.47 kB</td>
</tr>
</tbody></table></div>

        <h2 id="Install"   >
          <a href="#Install" class="heading-link"><i class="fas fa-link"></i></a><a href="#Install" class="headerlink" title="Install"></a>Install</h2>
      <figure class="highlight sh"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save asynckit</span><br></pre></td></tr></table></div></figure>


        <h2 id="Examples"   >
          <a href="#Examples" class="heading-link"><i class="fas fa-link"></i></a><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2>
      
        <h3 id="Parallel-Jobs"   >
          <a href="#Parallel-Jobs" class="heading-link"><i class="fas fa-link"></i></a><a href="#Parallel-Jobs" class="headerlink" title="Parallel Jobs"></a>Parallel Jobs</h3>
      <p>Runs iterator over provided array in parallel. Stores output in the <code>result</code> array,<br>on the matching positions. In unlikely event of an error from one of the jobs,<br>will terminate rest of the active jobs (if abort function is provided)<br>and return error along with salvaged data to the main callback function.</p>

        <h4 id="Input-Array"   >
          <a href="#Input-Array" class="heading-link"><i class="fas fa-link"></i></a><a href="#Input-Array" class="headerlink" title="Input Array"></a>Input Array</h4>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> parallel = <span class="built_in">require</span>(<span class="string">&#x27;asynckit&#x27;</span>).<span class="property">parallel</span></span><br><span class="line">  , assert   = <span class="built_in">require</span>(<span class="string">&#x27;assert&#x27;</span>)</span><br><span class="line">  ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> source         = [ <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">16</span>, <span class="number">64</span>, <span class="number">32</span>, <span class="number">8</span>, <span class="number">2</span> ]</span><br><span class="line">  , expectedResult = [ <span class="number">2</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">32</span>, <span class="number">128</span>, <span class="number">64</span>, <span class="number">16</span>, <span class="number">4</span> ]</span><br><span class="line">  , expectedTarget = [ <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">16</span>, <span class="number">32</span>, <span class="number">64</span> ]</span><br><span class="line">  , target         = []</span><br><span class="line">  ;</span><br><span class="line"></span><br><span class="line"><span class="title function_">parallel</span>(source, asyncJob, <span class="keyword">function</span>(<span class="params">err, result</span>)</span><br><span class="line">&#123;</span><br><span class="line">  assert.<span class="title function_">deepEqual</span>(result, expectedResult);</span><br><span class="line">  assert.<span class="title function_">deepEqual</span>(target, expectedTarget);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// async job accepts one element from the array</span></span><br><span class="line"><span class="comment">// and a callback function</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">asyncJob</span>(<span class="params">item, cb</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// different delays (in ms) per item</span></span><br><span class="line">  <span class="keyword">var</span> delay = item * <span class="number">25</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// pretend different jobs take different time to finish</span></span><br><span class="line">  <span class="comment">// and not in consequential order</span></span><br><span class="line">  <span class="keyword">var</span> timeoutId = <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    target.<span class="title function_">push</span>(item);</span><br><span class="line">    <span class="title function_">cb</span>(<span class="literal">null</span>, item * <span class="number">2</span>);</span><br><span class="line">  &#125;, delay);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// allow to cancel &quot;leftover&quot; jobs upon error</span></span><br><span class="line">  <span class="comment">// return function, invoking of which will abort this job</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">clearTimeout</span>.<span class="title function_">bind</span>(<span class="literal">null</span>, timeoutId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>More examples could be found in <a href="test/test-parallel-array.js">test&#x2F;test-parallel-array.js</a>.</p>

        <h4 id="Input-Object"   >
          <a href="#Input-Object" class="heading-link"><i class="fas fa-link"></i></a><a href="#Input-Object" class="headerlink" title="Input Object"></a>Input Object</h4>
      <p>Also it supports named jobs, listed via object.</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> parallel = <span class="built_in">require</span>(<span class="string">&#x27;asynckit/parallel&#x27;</span>)</span><br><span class="line">  , assert   = <span class="built_in">require</span>(<span class="string">&#x27;assert&#x27;</span>)</span><br><span class="line">  ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> source         = &#123; <span class="attr">first</span>: <span class="number">1</span>, <span class="attr">one</span>: <span class="number">1</span>, <span class="attr">four</span>: <span class="number">4</span>, <span class="attr">sixteen</span>: <span class="number">16</span>, <span class="attr">sixtyFour</span>: <span class="number">64</span>, <span class="attr">thirtyTwo</span>: <span class="number">32</span>, <span class="attr">eight</span>: <span class="number">8</span>, <span class="attr">two</span>: <span class="number">2</span> &#125;</span><br><span class="line">  , expectedResult = &#123; <span class="attr">first</span>: <span class="number">2</span>, <span class="attr">one</span>: <span class="number">2</span>, <span class="attr">four</span>: <span class="number">8</span>, <span class="attr">sixteen</span>: <span class="number">32</span>, <span class="attr">sixtyFour</span>: <span class="number">128</span>, <span class="attr">thirtyTwo</span>: <span class="number">64</span>, <span class="attr">eight</span>: <span class="number">16</span>, <span class="attr">two</span>: <span class="number">4</span> &#125;</span><br><span class="line">  , expectedTarget = [ <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">16</span>, <span class="number">32</span>, <span class="number">64</span> ]</span><br><span class="line">  , expectedKeys   = [ <span class="string">&#x27;first&#x27;</span>, <span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;four&#x27;</span>, <span class="string">&#x27;eight&#x27;</span>, <span class="string">&#x27;sixteen&#x27;</span>, <span class="string">&#x27;thirtyTwo&#x27;</span>, <span class="string">&#x27;sixtyFour&#x27;</span> ]</span><br><span class="line">  , target         = []</span><br><span class="line">  , keys           = []</span><br><span class="line">  ;</span><br><span class="line"></span><br><span class="line"><span class="title function_">parallel</span>(source, asyncJob, <span class="keyword">function</span>(<span class="params">err, result</span>)</span><br><span class="line">&#123;</span><br><span class="line">  assert.<span class="title function_">deepEqual</span>(result, expectedResult);</span><br><span class="line">  assert.<span class="title function_">deepEqual</span>(target, expectedTarget);</span><br><span class="line">  assert.<span class="title function_">deepEqual</span>(keys, expectedKeys);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// supports full value, key, callback (shortcut) interface</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">asyncJob</span>(<span class="params">item, key, cb</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// different delays (in ms) per item</span></span><br><span class="line">  <span class="keyword">var</span> delay = item * <span class="number">25</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// pretend different jobs take different time to finish</span></span><br><span class="line">  <span class="comment">// and not in consequential order</span></span><br><span class="line">  <span class="keyword">var</span> timeoutId = <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    keys.<span class="title function_">push</span>(key);</span><br><span class="line">    target.<span class="title function_">push</span>(item);</span><br><span class="line">    <span class="title function_">cb</span>(<span class="literal">null</span>, item * <span class="number">2</span>);</span><br><span class="line">  &#125;, delay);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// allow to cancel &quot;leftover&quot; jobs upon error</span></span><br><span class="line">  <span class="comment">// return function, invoking of which will abort this job</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">clearTimeout</span>.<span class="title function_">bind</span>(<span class="literal">null</span>, timeoutId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>More examples could be found in <a href="test/test-parallel-object.js">test&#x2F;test-parallel-object.js</a>.</p>

        <h3 id="Serial-Jobs"   >
          <a href="#Serial-Jobs" class="heading-link"><i class="fas fa-link"></i></a><a href="#Serial-Jobs" class="headerlink" title="Serial Jobs"></a>Serial Jobs</h3>
      <p>Runs iterator over provided array sequentially. Stores output in the <code>result</code> array,<br>on the matching positions. In unlikely event of an error from one of the jobs,<br>will not proceed to the rest of the items in the list<br>and return error along with salvaged data to the main callback function.</p>

        <h4 id="Input-Array-1"   >
          <a href="#Input-Array-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#Input-Array-1" class="headerlink" title="Input Array"></a>Input Array</h4>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> serial = <span class="built_in">require</span>(<span class="string">&#x27;asynckit/serial&#x27;</span>)</span><br><span class="line">  , assert = <span class="built_in">require</span>(<span class="string">&#x27;assert&#x27;</span>)</span><br><span class="line">  ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> source         = [ <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">16</span>, <span class="number">64</span>, <span class="number">32</span>, <span class="number">8</span>, <span class="number">2</span> ]</span><br><span class="line">  , expectedResult = [ <span class="number">2</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">32</span>, <span class="number">128</span>, <span class="number">64</span>, <span class="number">16</span>, <span class="number">4</span> ]</span><br><span class="line">  , expectedTarget = [ <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span> ]</span><br><span class="line">  , target         = []</span><br><span class="line">  ;</span><br><span class="line"></span><br><span class="line"><span class="title function_">serial</span>(source, asyncJob, <span class="keyword">function</span>(<span class="params">err, result</span>)</span><br><span class="line">&#123;</span><br><span class="line">  assert.<span class="title function_">deepEqual</span>(result, expectedResult);</span><br><span class="line">  assert.<span class="title function_">deepEqual</span>(target, expectedTarget);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// extended interface (item, key, callback)</span></span><br><span class="line"><span class="comment">// also supported for arrays</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">asyncJob</span>(<span class="params">item, key, cb</span>)</span><br><span class="line">&#123;</span><br><span class="line">  target.<span class="title function_">push</span>(key);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// it will be automatically made async</span></span><br><span class="line">  <span class="comment">// even it iterator &quot;returns&quot; in the same event loop</span></span><br><span class="line">  <span class="title function_">cb</span>(<span class="literal">null</span>, item * <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>More examples could be found in <a href="test/test-serial-array.js">test&#x2F;test-serial-array.js</a>.</p>

        <h4 id="Input-Object-1"   >
          <a href="#Input-Object-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#Input-Object-1" class="headerlink" title="Input Object"></a>Input Object</h4>
      <p>Also it supports named jobs, listed via object.</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> serial = <span class="built_in">require</span>(<span class="string">&#x27;asynckit&#x27;</span>).<span class="property">serial</span></span><br><span class="line">  , assert = <span class="built_in">require</span>(<span class="string">&#x27;assert&#x27;</span>)</span><br><span class="line">  ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> source         = [ <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">16</span>, <span class="number">64</span>, <span class="number">32</span>, <span class="number">8</span>, <span class="number">2</span> ]</span><br><span class="line">  , expectedResult = [ <span class="number">2</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">32</span>, <span class="number">128</span>, <span class="number">64</span>, <span class="number">16</span>, <span class="number">4</span> ]</span><br><span class="line">  , expectedTarget = [ <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span> ]</span><br><span class="line">  , target         = []</span><br><span class="line">  ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> source         = &#123; <span class="attr">first</span>: <span class="number">1</span>, <span class="attr">one</span>: <span class="number">1</span>, <span class="attr">four</span>: <span class="number">4</span>, <span class="attr">sixteen</span>: <span class="number">16</span>, <span class="attr">sixtyFour</span>: <span class="number">64</span>, <span class="attr">thirtyTwo</span>: <span class="number">32</span>, <span class="attr">eight</span>: <span class="number">8</span>, <span class="attr">two</span>: <span class="number">2</span> &#125;</span><br><span class="line">  , expectedResult = &#123; <span class="attr">first</span>: <span class="number">2</span>, <span class="attr">one</span>: <span class="number">2</span>, <span class="attr">four</span>: <span class="number">8</span>, <span class="attr">sixteen</span>: <span class="number">32</span>, <span class="attr">sixtyFour</span>: <span class="number">128</span>, <span class="attr">thirtyTwo</span>: <span class="number">64</span>, <span class="attr">eight</span>: <span class="number">16</span>, <span class="attr">two</span>: <span class="number">4</span> &#125;</span><br><span class="line">  , expectedTarget = [ <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">16</span>, <span class="number">64</span>, <span class="number">32</span>, <span class="number">8</span>, <span class="number">2</span> ]</span><br><span class="line">  , target         = []</span><br><span class="line">  ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_">serial</span>(source, asyncJob, <span class="keyword">function</span>(<span class="params">err, result</span>)</span><br><span class="line">&#123;</span><br><span class="line">  assert.<span class="title function_">deepEqual</span>(result, expectedResult);</span><br><span class="line">  assert.<span class="title function_">deepEqual</span>(target, expectedTarget);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// shortcut interface (item, callback)</span></span><br><span class="line"><span class="comment">// works for object as well as for the arrays</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">asyncJob</span>(<span class="params">item, cb</span>)</span><br><span class="line">&#123;</span><br><span class="line">  target.<span class="title function_">push</span>(item);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// it will be automatically made async</span></span><br><span class="line">  <span class="comment">// even it iterator &quot;returns&quot; in the same event loop</span></span><br><span class="line">  <span class="title function_">cb</span>(<span class="literal">null</span>, item * <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>More examples could be found in <a href="test/test-serial-object.js">test&#x2F;test-serial-object.js</a>.</p>
<p><em>Note: Since <em>object</em> is an <em>unordered</em> collection of properties,<br>it may produce unexpected results with sequential iterations.<br>Whenever order of the jobs’ execution is important please use <code>serialOrdered</code> method.</em></p>

        <h3 id="Ordered-Serial-Iterations"   >
          <a href="#Ordered-Serial-Iterations" class="heading-link"><i class="fas fa-link"></i></a><a href="#Ordered-Serial-Iterations" class="headerlink" title="Ordered Serial Iterations"></a>Ordered Serial Iterations</h3>
      <p>TBD</p>
<p>For example <a href="compare-property">compare-property</a> package.</p>

        <h3 id="Streaming-interface"   >
          <a href="#Streaming-interface" class="heading-link"><i class="fas fa-link"></i></a><a href="#Streaming-interface" class="headerlink" title="Streaming interface"></a>Streaming interface</h3>
      <p>TBD</p>

        <h2 id="Want-to-Know-More"   >
          <a href="#Want-to-Know-More" class="heading-link"><i class="fas fa-link"></i></a><a href="#Want-to-Know-More" class="headerlink" title="Want to Know More?"></a>Want to Know More?</h2>
      <p>More examples can be found in <a href="test/">test folder</a>.</p>
<p>Or open an <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/alexindigo/asynckit/issues" >issue</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> with questions and&#x2F;or suggestions.</p>

        <h2 id="License"   >
          <a href="#License" class="heading-link"><i class="fas fa-link"></i></a><a href="#License" class="headerlink" title="License"></a>License</h2>
      <p>AsyncKit is licensed under the MIT license.</p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/03/24/02_%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/01_%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8-demo/node_modules/assert-plus/README/">[ Untitled ]</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2023-03-24</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2016-01-28</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="assert-plus"   >
          <a href="#assert-plus" class="heading-link"><i class="fas fa-link"></i></a><a href="#assert-plus" class="headerlink" title="assert-plus"></a>assert-plus</h1>
      <p>This library is a super small wrapper over node’s assert module that has two<br>things: (1) the ability to disable assertions with the environment variable<br>NODE_NDEBUG, and (2) some API wrappers for argument testing.  Like<br><code>assert.string(myArg, &#39;myArg&#39;)</code>.  As a simple example, most of my code looks<br>like this:</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> assert = <span class="built_in">require</span>(<span class="string">&#x27;assert-plus&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fooAccount</span>(<span class="params">options, callback</span>) &#123;</span><br><span class="line">    assert.<span class="title function_">object</span>(options, <span class="string">&#x27;options&#x27;</span>);</span><br><span class="line">    assert.<span class="title function_">number</span>(options.<span class="property">id</span>, <span class="string">&#x27;options.id&#x27;</span>);</span><br><span class="line">    assert.<span class="title function_">bool</span>(options.<span class="property">isManager</span>, <span class="string">&#x27;options.isManager&#x27;</span>);</span><br><span class="line">    assert.<span class="title function_">string</span>(options.<span class="property">name</span>, <span class="string">&#x27;options.name&#x27;</span>);</span><br><span class="line">    assert.<span class="title function_">arrayOfString</span>(options.<span class="property">email</span>, <span class="string">&#x27;options.email&#x27;</span>);</span><br><span class="line">    assert.<span class="title function_">func</span>(callback, <span class="string">&#x27;callback&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Do stuff</span></span><br><span class="line">    <span class="title function_">callback</span>(<span class="literal">null</span>, &#123;&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="API"   >
          <a href="#API" class="heading-link"><i class="fas fa-link"></i></a><a href="#API" class="headerlink" title="API"></a>API</h1>
      <p>All methods that <em>aren’t</em> part of node’s core assert API are simply assumed to<br>take an argument, and then a string ‘name’ that’s not a message; <code>AssertionError</code><br>will be thrown if the assertion fails with a message like:</p>
<pre><code>AssertionError: foo (string) is required
at test (/home/mark/work/foo/foo.js:3:9)
at Object.&lt;anonymous&gt; (/home/mark/work/foo/foo.js:15:1)
at Module._compile (module.js:446:26)
at Object..js (module.js:464:10)
at Module.load (module.js:353:31)
at Function._load (module.js:311:12)
at Array.0 (module.js:484:10)
at EventEmitter._tickCallback (node.js:190:38)
</code></pre>
<p>from:</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params">foo</span>) &#123;</span><br><span class="line">    assert.<span class="title function_">string</span>(foo, <span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>There you go.  You can check that arrays are of a homogeneous type with <code>Arrayof$Type</code>:</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params">foo</span>) &#123;</span><br><span class="line">    assert.<span class="title function_">arrayOfString</span>(foo, <span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>You can assert IFF an argument is not <code>undefined</code> (i.e., an optional arg):</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">assert.<span class="title function_">optionalString</span>(foo, <span class="string">&#x27;foo&#x27;</span>);</span><br></pre></td></tr></table></div></figure>

<p>Lastly, you can opt-out of assertion checking altogether by setting the<br>environment variable <code>NODE_NDEBUG=1</code>.  This is pseudo-useful if you have<br>lots of assertions, and don’t want to pay <code>typeof ()</code> taxes to v8 in<br>production.  Be advised:  The standard functions re-exported from <code>assert</code> are<br>also disabled in assert-plus if NDEBUG is specified.  Using them directly from<br>the <code>assert</code> module avoids this behavior.</p>
<p>The complete list of APIs is:</p>
<ul>
<li>assert.array</li>
<li>assert.bool</li>
<li>assert.buffer</li>
<li>assert.func</li>
<li>assert.number</li>
<li>assert.finite</li>
<li>assert.object</li>
<li>assert.string</li>
<li>assert.stream</li>
<li>assert.date</li>
<li>assert.regexp</li>
<li>assert.uuid</li>
<li>assert.arrayOfArray</li>
<li>assert.arrayOfBool</li>
<li>assert.arrayOfBuffer</li>
<li>assert.arrayOfFunc</li>
<li>assert.arrayOfNumber</li>
<li>assert.arrayOfFinite</li>
<li>assert.arrayOfObject</li>
<li>assert.arrayOfString</li>
<li>assert.arrayOfStream</li>
<li>assert.arrayOfDate</li>
<li>assert.arrayOfRegexp</li>
<li>assert.arrayOfUuid</li>
<li>assert.optionalArray</li>
<li>assert.optionalBool</li>
<li>assert.optionalBuffer</li>
<li>assert.optionalFunc</li>
<li>assert.optionalNumber</li>
<li>assert.optionalFinite</li>
<li>assert.optionalObject</li>
<li>assert.optionalString</li>
<li>assert.optionalStream</li>
<li>assert.optionalDate</li>
<li>assert.optionalRegexp</li>
<li>assert.optionalUuid</li>
<li>assert.optionalArrayOfArray</li>
<li>assert.optionalArrayOfBool</li>
<li>assert.optionalArrayOfBuffer</li>
<li>assert.optionalArrayOfFunc</li>
<li>assert.optionalArrayOfNumber</li>
<li>assert.optionalArrayOfFinite</li>
<li>assert.optionalArrayOfObject</li>
<li>assert.optionalArrayOfString</li>
<li>assert.optionalArrayOfStream</li>
<li>assert.optionalArrayOfDate</li>
<li>assert.optionalArrayOfRegexp</li>
<li>assert.optionalArrayOfUuid</li>
<li>assert.AssertionError</li>
<li>assert.fail</li>
<li>assert.ok</li>
<li>assert.equal</li>
<li>assert.notEqual</li>
<li>assert.deepEqual</li>
<li>assert.notDeepEqual</li>
<li>assert.strictEqual</li>
<li>assert.notStrictEqual</li>
<li>assert.throws</li>
<li>assert.doesNotThrow</li>
<li>assert.ifError</li>
</ul>

        <h1 id="Installation"   >
          <a href="#Installation" class="heading-link"><i class="fas fa-link"></i></a><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h1>
      <pre><code>npm install assert-plus
</code></pre>

        <h2 id="License"   >
          <a href="#License" class="heading-link"><i class="fas fa-link"></i></a><a href="#License" class="headerlink" title="License"></a>License</h2>
      <p>The MIT License (MIT)<br>Copyright (c) 2012 Mark Cavage</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of<br>this software and associated documentation files (the “Software”), to deal in<br>the Software without restriction, including without limitation the rights to<br>use, copy, modify, merge, publish, distribute, sublicense, and&#x2F;or sell copies of<br>the Software, and to permit persons to whom the Software is furnished to do so,<br>subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all<br>copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR<br>IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,<br>FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE<br>AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER<br>LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,<br>OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE<br>SOFTWARE.</p>

        <h2 id="Bugs"   >
          <a href="#Bugs" class="heading-link"><i class="fas fa-link"></i></a><a href="#Bugs" class="headerlink" title="Bugs"></a>Bugs</h2>
      <p>See <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/mcavage/node-assert-plus/issues" >https://github.com/mcavage/node-assert-plus/issues</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>.</p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/03/24/02_%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/01_%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8-demo/node_modules/assert-plus/CHANGES/">[ Untitled ]</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2023-03-24</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2016-01-28</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="assert-plus-Changelog"   >
          <a href="#assert-plus-Changelog" class="heading-link"><i class="fas fa-link"></i></a><a href="#assert-plus-Changelog" class="headerlink" title="assert-plus Changelog"></a>assert-plus Changelog</h1>
      
        <h2 id="1-0-0"   >
          <a href="#1-0-0" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-0-0" class="headerlink" title="1.0.0"></a>1.0.0</h2>
      <ul>
<li><em>BREAKING</em> assert.number (and derivatives) now accept Infinity as valid input</li>
<li>Add assert.finite check.  Previous assert.number callers should use this if<br>they expect Infinity inputs to throw.</li>
</ul>

        <h2 id="0-2-0"   >
          <a href="#0-2-0" class="heading-link"><i class="fas fa-link"></i></a><a href="#0-2-0" class="headerlink" title="0.2.0"></a>0.2.0</h2>
      <ul>
<li>Fix <code>assert.object(null)</code> so it throws</li>
<li>Fix optional&#x2F;arrayOf exports for non-type-of asserts</li>
<li>Add optiona&#x2F;arrayOf exports for Stream&#x2F;Date&#x2F;Regex&#x2F;uuid</li>
<li>Add basic unit test coverage</li>
</ul>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/03/24/02_%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/01_%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8-demo/node_modules/asn1/README/">[ Untitled ]</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2023-03-24</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2018-07-31</span></span></div></header><div class="post-body"><div class="post-excerpt"><p>node-asn1 is a library for encoding and decoding ASN.1 datatypes in pure JS.<br>Currently BER encoding is supported; at some point I’ll likely have to do DER.</p>

        <h2 id="Usage"   >
          <a href="#Usage" class="heading-link"><i class="fas fa-link"></i></a><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2>
      <p>Mostly, if you’re <em>actually</em> needing to read and write ASN.1, you probably don’t<br>need this readme to explain what and why.  If you have no idea what ASN.1 is,<br>see this: <span class="exturl"><a class="exturl__link"   href="ftp://ftp.rsa.com/pub/pkcs/ascii/layman.asc" >ftp://ftp.rsa.com/pub/pkcs/ascii/layman.asc</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>The source is pretty much self-explanatory, and has read&#x2F;write methods for the<br>common types out there.</p>

        <h3 id="Decoding"   >
          <a href="#Decoding" class="heading-link"><i class="fas fa-link"></i></a><a href="#Decoding" class="headerlink" title="Decoding"></a>Decoding</h3>
      <p>The following reads an ASN.1 sequence with a boolean.</p>
<pre><code>var Ber = require(&#39;asn1&#39;).Ber;

var reader = new Ber.Reader(Buffer.from([0x30, 0x03, 0x01, 0x01, 0xff]));

reader.readSequence();
console.log(&#39;Sequence len: &#39; + reader.length);
if (reader.peek() === Ber.Boolean)
  console.log(reader.readBoolean());
</code></pre>

        <h3 id="Encoding"   >
          <a href="#Encoding" class="heading-link"><i class="fas fa-link"></i></a><a href="#Encoding" class="headerlink" title="Encoding"></a>Encoding</h3>
      <p>The following generates the same payload as above.</p>
<pre><code>var Ber = require(&#39;asn1&#39;).Ber;

var writer = new Ber.Writer();

writer.startSequence();
writer.writeBoolean(true);
writer.endSequence();

console.log(writer.buffer);
</code></pre>

        <h2 id="Installation"   >
          <a href="#Installation" class="heading-link"><i class="fas fa-link"></i></a><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2>
      <pre><code>npm install asn1
</code></pre>

        <h2 id="License"   >
          <a href="#License" class="heading-link"><i class="fas fa-link"></i></a><a href="#License" class="headerlink" title="License"></a>License</h2>
      <p>MIT.</p>

        <h2 id="Bugs"   >
          <a href="#Bugs" class="heading-link"><i class="fas fa-link"></i></a><a href="#Bugs" class="headerlink" title="Bugs"></a>Bugs</h2>
      <p>See <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/joyent/node-asn1/issues" >https://github.com/joyent/node-asn1/issues</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>.</p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/03/24/02_%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/01_%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8-demo/node_modules/ajv/lib/dotjs/README/">[ Untitled ]</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2023-03-24</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">1985-10-26</span></span></div></header><div class="post-body"><div class="post-excerpt"><p>These files are compiled dot templates from dot folder.</p>
<p>Do NOT edit them directly, edit the templates and run <code>npm run build</code> from main ajv folder.</p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/03/24/02_%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/01_%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8-demo/node_modules/ajv/README/">[ Untitled ]</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2023-03-24</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">1985-10-26</span></span></div></header><div class="post-body"><div class="post-excerpt"><img align="right" alt="Ajv logo" width="160" src="https://ajv.js.org/images/ajv_logo.png">


        <h1 id="Ajv-Another-JSON-Schema-Validator"   >
          <a href="#Ajv-Another-JSON-Schema-Validator" class="heading-link"><i class="fas fa-link"></i></a><a href="#Ajv-Another-JSON-Schema-Validator" class="headerlink" title="Ajv: Another JSON Schema Validator"></a>Ajv: Another JSON Schema Validator</h1>
      <p>The fastest JSON Schema validator for Node.js and browser. Supports draft-04&#x2F;06&#x2F;07.</p>
<p><a target="_blank" rel="noopener" href="https://travis-ci.org/ajv-validator/ajv"><img   src="https://travis-ci.org/ajv-validator/ajv.svg?branch=master" style=""  alt="Build Status"></a><br><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/ajv"><img src="https://img.shields.io/npm/v/ajv.svg" alt="npm"></a><br><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/ajv/v/7.0.0-beta.0"><img src="https://img.shields.io/npm/v/ajv/beta" alt="npm (beta)"></a><br><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/ajv"><img src="https://img.shields.io/npm/dm/ajv.svg" alt="npm downloads"></a><br><a target="_blank" rel="noopener" href="https://coveralls.io/github/ajv-validator/ajv?branch=master"><img   src="https://coveralls.io/repos/github/ajv-validator/ajv/badge.svg?branch=master" style=""  alt="Coverage Status"></a><br><a target="_blank" rel="noopener" href="https://gitter.im/ajv-validator/ajv"><img src="https://img.shields.io/gitter/room/ajv-validator/ajv.svg" alt="Gitter"></a><br><a target="_blank" rel="noopener" href="https://github.com/sponsors/epoberezkin"><img src="https://img.shields.io/badge/$-sponsors-brightgreen" alt="GitHub Sponsors"></a></p>

        <h2 id="Ajv-v7-beta-is-released"   >
          <a href="#Ajv-v7-beta-is-released" class="heading-link"><i class="fas fa-link"></i></a><a href="#Ajv-v7-beta-is-released" class="headerlink" title="Ajv v7 beta is released"></a>Ajv v7 beta is released</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/tree/v7-beta" >Ajv version 7.0.0-beta.0</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> is released with these changes:</p>
<ul>
<li>to reduce the mistakes in JSON schemas and unexpected validation results, <a href="./docs/strict-mode.md">strict mode</a> is added - it prohibits ignored or ambiguous JSON Schema elements.</li>
<li>to make code injection from untrusted schemas impossible, <a href="./docs/codegen.md">code generation</a> is fully re-written to be safe.</li>
<li>to simplify Ajv extensions, the new keyword API that is used by pre-defined keywords is available to user-defined keywords - it is much easier to define any keywords now, especially with subschemas.</li>
<li>schemas are compiled to ES6 code (ES5 code generation is supported with an option).</li>
<li>to improve reliability and maintainability the code is migrated to TypeScript.</li>
</ul>
<p><strong>Please note</strong>:</p>
<ul>
<li>the support for JSON-Schema draft-04 is removed - if you have schemas using “id” attributes you have to replace them with “$id” (or continue using version 6 that will be supported until 02&#x2F;28&#x2F;2021).</li>
<li>all formats are separated to ajv-formats package - they have to be explicitely added if you use them.</li>
</ul>
<p>See <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/releases/tag/v7.0.0-beta.0" >release notes</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> for the details.</p>
<p>To install the new version:</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install ajv@beta</span><br></pre></td></tr></table></div></figure>

<p>See <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/tree/v7-beta#usage" >Getting started with v7</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> for code example.</p>

        <h2 id="Mozilla-MOSS-grant-and-OpenJS-Foundation"   >
          <a href="#Mozilla-MOSS-grant-and-OpenJS-Foundation" class="heading-link"><i class="fas fa-link"></i></a><a href="#Mozilla-MOSS-grant-and-OpenJS-Foundation" class="headerlink" title="Mozilla MOSS grant and OpenJS Foundation"></a>Mozilla MOSS grant and OpenJS Foundation</h2>
      <p><a target="_blank" rel="noopener" href="https://www.mozilla.org/en-US/moss/"><img src="https://www.poberezkin.com/images/mozilla.png" width="240" height="68"></a> &amp;nbsp;&amp;nbsp;&amp;nbsp; <a target="_blank" rel="noopener" href="https://openjsf.org/blog/2020/08/14/ajv-joins-openjs-foundation-as-an-incubation-project/"><img src="https://www.poberezkin.com/images/openjs.png" width="220" height="68"></a></p>
<p>Ajv has been awarded a grant from Mozilla’s <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.mozilla.org/en-US/moss/" >Open Source Support (MOSS) program</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> in the “Foundational Technology” track! It will sponsor the development of Ajv support of <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://tools.ietf.org/html/draft-handrews-json-schema-02" >JSON Schema version 2019-09</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> and of <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://tools.ietf.org/html/draft-ucarion-json-type-definition-04" >JSON Type Definition</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>.</p>
<p>Ajv also joined <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://openjsf.org/" >OpenJS Foundation</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> – having this support will help ensure the longevity and stability of Ajv for all its users.</p>
<p>This <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.poberezkin.com/posts/2020-08-14-ajv-json-validator-mozilla-open-source-grant-openjs-foundation.html" >blog post</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> has more details.</p>
<p>I am looking for the long term maintainers of Ajv – working with <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.thereadyset.co/" >ReadySet</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>, also sponsored by Mozilla, to establish clear guidelines for the role of a “maintainer” and the contribution standards, and to encourage a wider, more inclusive, contribution from the community.</p>

        <h2 id="Please-sponsor-Ajv-development"   >
          <a href="#Please-sponsor-Ajv-development" class="heading-link"><i class="fas fa-link"></i></a><a href="#Please-sponsor-Ajv-development" class="headerlink" title="Please sponsor Ajv development"></a>Please <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/sponsors/epoberezkin" >sponsor Ajv development</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></h2>
      <p>Since I asked to support Ajv development 40 people and 6 organizations contributed via GitHub and OpenCollective - this support helped receiving the MOSS grant!</p>
<p>Your continuing support is very important - the funds will be used to develop and maintain Ajv once the next major version is released.</p>
<p>Please sponsor Ajv via:</p>
<ul>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/sponsors/epoberezkin" >GitHub sponsors page</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> (GitHub will match it)</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://opencollective.com/ajv" >Ajv Open Collective️</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li>
</ul>
<p>Thank you.</p>

        <h4 id="Open-Collective-sponsors"   >
          <a href="#Open-Collective-sponsors" class="heading-link"><i class="fas fa-link"></i></a><a href="#Open-Collective-sponsors" class="headerlink" title="Open Collective sponsors"></a>Open Collective sponsors</h4>
      <p><a target="_blank" rel="noopener" href="https://opencollective.com/ajv"><img   src="https://opencollective.com/ajv/individuals.svg?width=890" style="" ></a></p>
<p><a target="_blank" rel="noopener" href="https://opencollective.com/ajv/organization/0/website"><img src="https://opencollective.com/ajv/organization/0/avatar.svg"></a><br><a target="_blank" rel="noopener" href="https://opencollective.com/ajv/organization/1/website"><img src="https://opencollective.com/ajv/organization/1/avatar.svg"></a><br><a target="_blank" rel="noopener" href="https://opencollective.com/ajv/organization/2/website"><img src="https://opencollective.com/ajv/organization/2/avatar.svg"></a><br><a target="_blank" rel="noopener" href="https://opencollective.com/ajv/organization/3/website"><img src="https://opencollective.com/ajv/organization/3/avatar.svg"></a><br><a target="_blank" rel="noopener" href="https://opencollective.com/ajv/organization/4/website"><img src="https://opencollective.com/ajv/organization/4/avatar.svg"></a><br><a target="_blank" rel="noopener" href="https://opencollective.com/ajv/organization/5/website"><img src="https://opencollective.com/ajv/organization/5/avatar.svg"></a><br><a target="_blank" rel="noopener" href="https://opencollective.com/ajv/organization/6/website"><img src="https://opencollective.com/ajv/organization/6/avatar.svg"></a><br><a target="_blank" rel="noopener" href="https://opencollective.com/ajv/organization/7/website"><img src="https://opencollective.com/ajv/organization/7/avatar.svg"></a><br><a target="_blank" rel="noopener" href="https://opencollective.com/ajv/organization/8/website"><img src="https://opencollective.com/ajv/organization/8/avatar.svg"></a><br><a target="_blank" rel="noopener" href="https://opencollective.com/ajv/organization/9/website"><img src="https://opencollective.com/ajv/organization/9/avatar.svg"></a></p>

        <h2 id="Using-version-6"   >
          <a href="#Using-version-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#Using-version-6" class="headerlink" title="Using version 6"></a>Using version 6</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://json-schema.org/latest/json-schema-validation.html" >JSON Schema draft-07</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> is published.</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/releases/tag/v6.0.0" >Ajv version 6.0.0</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> that supports draft-07 is released. It may require either migrating your schemas or updating your code (to continue using draft-04 and v5 schemas, draft-06 schemas will be supported without changes).</p>
<p><strong>Please note</strong>: To use Ajv with draft-06 schemas you need to explicitly add the meta-schema to the validator instance:</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ajv.<span class="title function_">addMetaSchema</span>(<span class="built_in">require</span>(<span class="string">&#x27;ajv/lib/refs/json-schema-draft-06.json&#x27;</span>));</span><br></pre></td></tr></table></div></figure>

<p>To use Ajv with draft-04 schemas in addition to explicitly adding meta-schema you also need to use option schemaId:</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ajv = <span class="keyword">new</span> <span class="title class_">Ajv</span>(&#123;<span class="attr">schemaId</span>: <span class="string">&#x27;id&#x27;</span>&#125;);</span><br><span class="line"><span class="comment">// If you want to use both draft-04 and draft-06/07 schemas:</span></span><br><span class="line"><span class="comment">// var ajv = new Ajv(&#123;schemaId: &#x27;auto&#x27;&#125;);</span></span><br><span class="line">ajv.<span class="title function_">addMetaSchema</span>(<span class="built_in">require</span>(<span class="string">&#x27;ajv/lib/refs/json-schema-draft-04.json&#x27;</span>));</span><br></pre></td></tr></table></div></figure>



        <h2 id="Contents"   >
          <a href="#Contents" class="heading-link"><i class="fas fa-link"></i></a><a href="#Contents" class="headerlink" title="Contents"></a>Contents</h2>
      <ul>
<li><a href="#performance">Performance</a></li>
<li><a href="#features">Features</a></li>
<li><a href="#getting-started">Getting started</a></li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/blob/master/FAQ.md" >Frequently Asked Questions</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li>
<li><a href="#using-in-browser">Using in browser</a><ul>
<li><a href="#ajv-and-content-security-policies-csp">Ajv and Content Security Policies (CSP)</a></li>
</ul>
</li>
<li><a href="#command-line-interface">Command line interface</a></li>
<li>Validation<ul>
<li><a href="#validation-keywords">Keywords</a></li>
<li><a href="#annotation-keywords">Annotation keywords</a></li>
<li><a href="#formats">Formats</a></li>
<li><a href="#ref">Combining schemas with $ref</a></li>
<li><a href="#data-reference">$data reference</a></li>
<li>NEW: <a href="#merge-and-patch-keywords">$merge and $patch keywords</a></li>
<li><a href="#defining-custom-keywords">Defining custom keywords</a></li>
<li><a href="#asynchronous-schema-compilation">Asynchronous schema compilation</a></li>
<li><a href="#asynchronous-validation">Asynchronous validation</a></li>
</ul>
</li>
<li><a href="#security-considerations">Security considerations</a><ul>
<li><a href="#security-contact">Security contact</a></li>
<li><a href="#untrusted-schemas">Untrusted schemas</a></li>
<li><a href="#circular-references-in-javascript-objects">Circular references in objects</a></li>
<li><a href="#security-risks-of-trusted-schemas">Trusted schemas</a></li>
<li><a href="#redos-attack">ReDoS attack</a></li>
</ul>
</li>
<li>Modifying data during validation<ul>
<li><a href="#filtering-data">Filtering data</a></li>
<li><a href="#assigning-defaults">Assigning defaults</a></li>
<li><a href="#coercing-data-types">Coercing data types</a></li>
</ul>
</li>
<li>API<ul>
<li><a href="#api">Methods</a></li>
<li><a href="#options">Options</a></li>
<li><a href="#validation-errors">Validation errors</a></li>
</ul>
</li>
<li><a href="#plugins">Plugins</a></li>
<li><a href="#related-packages">Related packages</a></li>
<li><a href="#some-packages-using-ajv">Some packages using Ajv</a></li>
<li><a href="#tests">Tests, Contributing, Changes history</a></li>
<li><a href="#open-source-software-support">Support, Code of conduct, License</a></li>
</ul>

        <h2 id="Performance"   >
          <a href="#Performance" class="heading-link"><i class="fas fa-link"></i></a><a href="#Performance" class="headerlink" title="Performance"></a>Performance</h2>
      <p>Ajv generates code using <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/olado/doT" >doT templates</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> to turn JSON Schemas into super-fast validation functions that are efficient for v8 optimization.</p>
<p>Currently Ajv is the fastest and the most standard compliant validator according to these benchmarks:</p>
<ul>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ebdrup/json-schema-benchmark" >json-schema-benchmark</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - 50% faster than the second place</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/pandastrike/jsck#benchmarks" >jsck benchmark</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - 20-190% faster</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://rawgit.com/zaggino/z-schema/master/benchmark/results.html" >z-schema benchmark</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://cdn.rawgit.com/playlyfe/themis/master/benchmark/results.html" >themis benchmark</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li>
</ul>
<p>Performance of different validators by <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ebdrup/json-schema-benchmark" >json-schema-benchmark</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>:</p>
<p><a target="_blank" rel="noopener" href="https://github.com/ebdrup/json-schema-benchmark/blob/master/README.md#performance"><img   src="https://chart.googleapis.com/chart?chxt=x,y&cht=bhs&chco=76A4FB&chls=2.0&chbh=32,4,1&chs=600x416&chxl=-1:%7Cdjv%7Cajv%7Cjson-schema-validator-generator%7Cjsen%7Cis-my-json-valid%7Cthemis%7Cz-schema%7Cjsck%7Cskeemas%7Cjson-schema-library%7Ctv4&chd=t:100,98,72.1,66.8,50.1,15.1,6.1,3.8,1.2,0.7,0.2" style=""  alt="performance"></a></p>

        <h2 id="Features"   >
          <a href="#Features" class="heading-link"><i class="fas fa-link"></i></a><a href="#Features" class="headerlink" title="Features"></a>Features</h2>
      <ul>
<li>Ajv implements full JSON Schema <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://json-schema.org/" >draft-06&#x2F;07</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> and draft-04 standards:<ul>
<li>all validation keywords (see <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md" >JSON Schema validation keywords</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>)</li>
<li>full support of remote refs (remote schemas have to be added with <code>addSchema</code> or compiled to be available)</li>
<li>support of circular references between schemas</li>
<li>correct string lengths for strings with unicode pairs (can be turned off)</li>
<li><a href="#formats">formats</a> defined by JSON Schema draft-07 standard and custom formats (can be turned off)</li>
<li><a href="#api-validateschema">validates schemas against meta-schema</a></li>
</ul>
</li>
<li>supports <a href="#using-in-browser">browsers</a> and Node.js 0.10-14.x</li>
<li><a href="#asynchronous-schema-compilation">asynchronous loading</a> of referenced schemas during compilation</li>
<li>“All errors” validation mode with <a href="#options">option allErrors</a></li>
<li><a href="#validation-errors">error messages with parameters</a> describing error reasons to allow creating custom error messages</li>
<li>i18n error messages support with <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv-i18n" >ajv-i18n</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> package</li>
<li><a href="#filtering-data">filtering data</a> from additional properties</li>
<li><a href="#assigning-defaults">assigning defaults</a> to missing properties and items</li>
<li><a href="#coercing-data-types">coercing data</a> to the types specified in <code>type</code> keywords</li>
<li><a href="#defining-custom-keywords">custom keywords</a></li>
<li>draft-06&#x2F;07 keywords <code>const</code>, <code>contains</code>, <code>propertyNames</code> and <code>if/then/else</code></li>
<li>draft-06 boolean schemas (<code>true</code>&#x2F;<code>false</code> as a schema to always pass&#x2F;fail).</li>
<li>keywords <code>switch</code>, <code>patternRequired</code>, <code>formatMaximum</code> &#x2F; <code>formatMinimum</code> and <code>formatExclusiveMaximum</code> &#x2F; <code>formatExclusiveMinimum</code> from <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/json-schema/json-schema/wiki/v5-Proposals" >JSON Schema extension proposals</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> with <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv-keywords" >ajv-keywords</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> package</li>
<li><a href="#data-reference">$data reference</a> to use values from the validated data as values for the schema keywords</li>
<li><a href="#asynchronous-validation">asynchronous validation</a> of custom formats and keywords</li>
</ul>

        <h2 id="Install"   >
          <a href="#Install" class="heading-link"><i class="fas fa-link"></i></a><a href="#Install" class="headerlink" title="Install"></a>Install</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install ajv</span><br></pre></td></tr></table></div></figure>



        <h2 id="Getting-started"   >
          <a href="#Getting-started" class="heading-link"><i class="fas fa-link"></i></a><a href="#Getting-started" class="headerlink" title="Getting started"></a><a name="usage"></a>Getting started</h2>
      <p>Try it in the Node.js REPL: <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://tonicdev.com/npm/ajv" >https://tonicdev.com/npm/ajv</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>The fastest validation call:</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Node.js require:</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Ajv</span> = <span class="built_in">require</span>(<span class="string">&#x27;ajv&#x27;</span>);</span><br><span class="line"><span class="comment">// or ESM/TypeScript import</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Ajv</span> <span class="keyword">from</span> <span class="string">&#x27;ajv&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ajv = <span class="keyword">new</span> <span class="title class_">Ajv</span>(); <span class="comment">// options can be passed, e.g. &#123;allErrors: true&#125;</span></span><br><span class="line"><span class="keyword">var</span> validate = ajv.<span class="title function_">compile</span>(schema);</span><br><span class="line"><span class="keyword">var</span> valid = <span class="title function_">validate</span>(data);</span><br><span class="line"><span class="keyword">if</span> (!valid) <span class="variable language_">console</span>.<span class="title function_">log</span>(validate.<span class="property">errors</span>);</span><br></pre></td></tr></table></div></figure>

<p>or with less code</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">var</span> valid = ajv.<span class="title function_">validate</span>(schema, data);</span><br><span class="line"><span class="keyword">if</span> (!valid) <span class="variable language_">console</span>.<span class="title function_">log</span>(ajv.<span class="property">errors</span>);</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></div></figure>

<p>or</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">var</span> valid = ajv.<span class="title function_">addSchema</span>(schema, <span class="string">&#x27;mySchema&#x27;</span>)</span><br><span class="line">               .<span class="title function_">validate</span>(<span class="string">&#x27;mySchema&#x27;</span>, data);</span><br><span class="line"><span class="keyword">if</span> (!valid) <span class="variable language_">console</span>.<span class="title function_">log</span>(ajv.<span class="title function_">errorsText</span>());</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></div></figure>

<p>See <a href="#api">API</a> and <a href="#options">Options</a> for more details.</p>
<p>Ajv compiles schemas to functions and caches them in all cases (using schema serialized with <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/epoberezkin/fast-json-stable-stringify" >fast-json-stable-stringify</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> or a custom function as a key), so that the next time the same schema is used (not necessarily the same object instance) it won’t be compiled again.</p>
<p>The best performance is achieved when using compiled functions returned by <code>compile</code> or <code>getSchema</code> methods (there is no additional function call).</p>
<p><strong>Please note</strong>: every time a validation function or <code>ajv.validate</code> are called <code>errors</code> property is overwritten. You need to copy <code>errors</code> array reference to another variable if you want to use it later (e.g., in the callback). See <a href="#validation-errors">Validation errors</a></p>
<p><strong>Note for TypeScript users</strong>: <code>ajv</code> provides its own TypeScript declarations<br>out of the box, so you don’t need to install the deprecated <code>@types/ajv</code><br>module.</p>

        <h2 id="Using-in-browser"   >
          <a href="#Using-in-browser" class="heading-link"><i class="fas fa-link"></i></a><a href="#Using-in-browser" class="headerlink" title="Using in browser"></a>Using in browser</h2>
      <p>You can require Ajv directly from the code you browserify - in this case Ajv will be a part of your bundle.</p>
<p>If you need to use Ajv in several bundles you can create a separate UMD bundle using <code>npm run bundle</code> script (thanks to <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/siddo420" >siddo420</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>).</p>
<p>Then you need to load Ajv in the browser:</p>
<figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;ajv.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></div></figure>

<p>This bundle can be used with different module systems; it creates global <code>Ajv</code> if no module system is found.</p>
<p>The browser bundle is available on <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://cdnjs.com/libraries/ajv" >cdnjs</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>.</p>
<p>Ajv is tested with these browsers:</p>
<p><a target="_blank" rel="noopener" href="https://saucelabs.com/u/epoberezkin"><img src="https://saucelabs.com/browser-matrix/epoberezkin.svg" alt="Sauce Test Status"></a></p>
<p><strong>Please note</strong>: some frameworks, e.g. Dojo, may redefine global require in such way that is not compatible with CommonJS module format. In such case Ajv bundle has to be loaded before the framework and then you can use global Ajv (see issue <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/issues/234" >#234</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>).</p>

        <h3 id="Ajv-and-Content-Security-Policies-CSP"   >
          <a href="#Ajv-and-Content-Security-Policies-CSP" class="heading-link"><i class="fas fa-link"></i></a><a href="#Ajv-and-Content-Security-Policies-CSP" class="headerlink" title="Ajv and Content Security Policies (CSP)"></a>Ajv and Content Security Policies (CSP)</h3>
      <p>If you’re using Ajv to compile a schema (the typical use) in a browser document that is loaded with a Content Security Policy (CSP), that policy will require a <code>script-src</code> directive that includes the value <code>&#39;unsafe-eval&#39;</code>.<br>:warning: NOTE, however, that <code>unsafe-eval</code> is NOT recommended in a secure CSP<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/contentSecurityPolicy#relaxing-eval" >[1]</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>, as it has the potential to open the document to cross-site scripting (XSS) attacks.</p>
<p>In order to make use of Ajv without easing your CSP, you can <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv-cli#compile-schemas" >pre-compile a schema using the CLI</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>. This will transpile the schema JSON into a JavaScript file that exports a <code>validate</code> function that works simlarly to a schema compiled at runtime.</p>
<p>Note that pre-compilation of schemas is performed using <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv-pack" >ajv-pack</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> and there are <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv-pack#limitations" >some limitations to the schema features it can compile</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>. A successfully pre-compiled schema is equivalent to the same schema compiled at runtime.</p>

        <h2 id="Command-line-interface"   >
          <a href="#Command-line-interface" class="heading-link"><i class="fas fa-link"></i></a><a href="#Command-line-interface" class="headerlink" title="Command line interface"></a>Command line interface</h2>
      <p>CLI is available as a separate npm package <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv-cli" >ajv-cli</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>. It supports:</p>
<ul>
<li>compiling JSON Schemas to test their validity</li>
<li>BETA: generating standalone module exporting a validation function to be used without Ajv (using <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv-pack" >ajv-pack</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>)</li>
<li>migrate schemas to draft-07 (using <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/epoberezkin/json-schema-migrate" >json-schema-migrate</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>)</li>
<li>validating data file(s) against JSON Schema</li>
<li>testing expected validity of data against JSON Schema</li>
<li>referenced schemas</li>
<li>custom meta-schemas</li>
<li>files in JSON, JSON5, YAML, and JavaScript format</li>
<li>all Ajv options</li>
<li>reporting changes in data after validation in <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6902" >JSON-patch</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> format</li>
</ul>

        <h2 id="Validation-keywords"   >
          <a href="#Validation-keywords" class="heading-link"><i class="fas fa-link"></i></a><a href="#Validation-keywords" class="headerlink" title="Validation keywords"></a>Validation keywords</h2>
      <p>Ajv supports all validation keywords from draft-07 of JSON Schema standard:</p>
<ul>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#type" >type</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#keywords-for-numbers" >for numbers</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - maximum, minimum, exclusiveMaximum, exclusiveMinimum, multipleOf</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#keywords-for-strings" >for strings</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - maxLength, minLength, pattern, format</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#keywords-for-arrays" >for arrays</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - maxItems, minItems, uniqueItems, items, additionalItems, <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#contains" >contains</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#keywords-for-objects" >for objects</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - maxProperties, minProperties, required, properties, patternProperties, additionalProperties, dependencies, <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#propertynames" >propertyNames</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#keywords-for-all-types" >for all types</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - enum, <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#const" >const</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#compound-keywords" >compound keywords</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - not, oneOf, anyOf, allOf, <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#ifthenelse" >if&#x2F;then&#x2F;else</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li>
</ul>
<p>With <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv-keywords" >ajv-keywords</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> package Ajv also supports validation keywords from <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/json-schema/json-schema/wiki/v5-Proposals" >JSON Schema extension proposals</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> for JSON Schema standard:</p>
<ul>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#patternrequired-proposed" >patternRequired</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - like <code>required</code> but with patterns that some property should match.</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md#formatmaximum--formatminimum-and-exclusiveformatmaximum--exclusiveformatminimum-proposed" >formatMaximum, formatMinimum, formatExclusiveMaximum, formatExclusiveMinimum</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - setting limits for date, time, etc.</li>
</ul>
<p>See <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/blob/master/KEYWORDS.md" >JSON Schema validation keywords</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> for more details.</p>

        <h2 id="Annotation-keywords"   >
          <a href="#Annotation-keywords" class="heading-link"><i class="fas fa-link"></i></a><a href="#Annotation-keywords" class="headerlink" title="Annotation keywords"></a>Annotation keywords</h2>
      <p>JSON Schema specification defines several annotation keywords that describe schema itself but do not perform any validation.</p>
<ul>
<li><code>title</code> and <code>description</code>: information about the data represented by that schema</li>
<li><code>$comment</code> (NEW in draft-07): information for developers. With option <code>$comment</code> Ajv logs or passes the comment string to the user-supplied function. See <a href="#options">Options</a>.</li>
<li><code>default</code>: a default value of the data instance, see <a href="#assigning-defaults">Assigning defaults</a>.</li>
<li><code>examples</code> (NEW in draft-06): an array of data instances. Ajv does not check the validity of these instances against the schema.</li>
<li><code>readOnly</code> and <code>writeOnly</code> (NEW in draft-07): marks data-instance as read-only or write-only in relation to the source of the data (database, api, etc.).</li>
<li><code>contentEncoding</code>: <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc2045#section-6.1" >RFC 2045</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>, e.g., “base64”.</li>
<li><code>contentMediaType</code>: <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc2046" >RFC 2046</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>, e.g., “image&#x2F;png”.</li>
</ul>
<p><strong>Please note</strong>:  Ajv does not implement validation of the keywords <code>examples</code>, <code>contentEncoding</code> and <code>contentMediaType</code> but it reserves them. If you want to create a plugin that implements some of them, it should remove these keywords from the instance.</p>

        <h2 id="Formats"   >
          <a href="#Formats" class="heading-link"><i class="fas fa-link"></i></a><a href="#Formats" class="headerlink" title="Formats"></a>Formats</h2>
      <p>Ajv implements formats defined by JSON Schema specification and several other formats. It is recommended NOT to use “format” keyword implementations with untrusted data, as they use potentially unsafe regular expressions - see <a href="#redos-attack">ReDoS attack</a>.</p>
<p><strong>Please note</strong>: if you need to use “format” keyword to validate untrusted data, you MUST assess their suitability and safety for your validation scenarios.</p>
<p>The following formats are implemented for string validation with “format” keyword:</p>
<ul>
<li><em>date</em>: full-date according to <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://tools.ietf.org/html/rfc3339#section-5.6" >RFC3339</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>.</li>
<li><em>time</em>: time with optional time-zone.</li>
<li><em>date-time</em>: date-time from the same source (time-zone is mandatory). <code>date</code>, <code>time</code> and <code>date-time</code> validate ranges in <code>full</code> mode and only regexp in <code>fast</code> mode (see <a href="#options">options</a>).</li>
<li><em>uri</em>: full URI.</li>
<li><em>uri-reference</em>: URI reference, including full and relative URIs.</li>
<li><em>uri-template</em>: URI template according to <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6570" >RFC6570</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li>
<li><em>url</em> (deprecated): <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://url.spec.whatwg.org/#concept-url" >URL record</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>.</li>
<li><em>email</em>: email address.</li>
<li><em>hostname</em>: host name according to <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://tools.ietf.org/html/rfc1034#section-3.5" >RFC1034</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>.</li>
<li><em>ipv4</em>: IP address v4.</li>
<li><em>ipv6</em>: IP address v6.</li>
<li><em>regex</em>: tests whether a string is a valid regular expression by passing it to RegExp constructor.</li>
<li><em>uuid</em>: Universally Unique IDentifier according to <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://tools.ietf.org/html/rfc4122" >RFC4122</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>.</li>
<li><em>json-pointer</em>: JSON-pointer according to <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6901" >RFC6901</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>.</li>
<li><em>relative-json-pointer</em>: relative JSON-pointer according to <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://tools.ietf.org/html/draft-luff-relative-json-pointer-00" >this draft</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>.</li>
</ul>
<p><strong>Please note</strong>: JSON Schema draft-07 also defines formats <code>iri</code>, <code>iri-reference</code>, <code>idn-hostname</code> and <code>idn-email</code> for URLs, hostnames and emails with international characters. Ajv does not implement these formats. If you create Ajv plugin that implements them please make a PR to mention this plugin here.</p>
<p>There are two modes of format validation: <code>fast</code> and <code>full</code>. This mode affects formats <code>date</code>, <code>time</code>, <code>date-time</code>, <code>uri</code>, <code>uri-reference</code>, and <code>email</code>. See <a href="#options">Options</a> for details.</p>
<p>You can add additional formats and replace any of the formats above using <a href="#api-addformat">addFormat</a> method.</p>
<p>The option <code>unknownFormats</code> allows changing the default behaviour when an unknown format is encountered. In this case Ajv can either fail schema compilation (default) or ignore it (default in versions before 5.0.0). You also can allow specific format(s) that will be ignored. See <a href="#options">Options</a> for details.</p>
<p>You can find regular expressions used for format validation and the sources that were used in <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/blob/master/lib/compile/formats.js" >formats.js</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>.</p>

        <h2 id="Combining-schemas-with-ref"   >
          <a href="#Combining-schemas-with-ref" class="heading-link"><i class="fas fa-link"></i></a><a href="#Combining-schemas-with-ref" class="headerlink" title="Combining schemas with $ref"></a><a name="ref"></a>Combining schemas with $ref</h2>
      <p>You can structure your validation logic across multiple schema files and have schemas reference each other using <code>$ref</code> keyword.</p>
<p>Example:</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = &#123;</span><br><span class="line">  <span class="string">&quot;$id&quot;</span>: <span class="string">&quot;http://example.com/schemas/schema.json&quot;</span>,</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;object&quot;</span>,</span><br><span class="line">  <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;foo&quot;</span>: &#123; <span class="string">&quot;$ref&quot;</span>: <span class="string">&quot;defs.json#/definitions/int&quot;</span> &#125;,</span><br><span class="line">    <span class="string">&quot;bar&quot;</span>: &#123; <span class="string">&quot;$ref&quot;</span>: <span class="string">&quot;defs.json#/definitions/str&quot;</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> defsSchema = &#123;</span><br><span class="line">  <span class="string">&quot;$id&quot;</span>: <span class="string">&quot;http://example.com/schemas/defs.json&quot;</span>,</span><br><span class="line">  <span class="string">&quot;definitions&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;int&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;integer&quot;</span> &#125;,</span><br><span class="line">    <span class="string">&quot;str&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<p>Now to compile your schema you can either pass all schemas to Ajv instance:</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ajv = <span class="keyword">new</span> <span class="title class_">Ajv</span>(&#123;<span class="attr">schemas</span>: [schema, defsSchema]&#125;);</span><br><span class="line"><span class="keyword">var</span> validate = ajv.<span class="title function_">getSchema</span>(<span class="string">&#x27;http://example.com/schemas/schema.json&#x27;</span>);</span><br></pre></td></tr></table></div></figure>

<p>or use <code>addSchema</code> method:</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ajv = <span class="keyword">new</span> <span class="title class_">Ajv</span>;</span><br><span class="line"><span class="keyword">var</span> validate = ajv.<span class="title function_">addSchema</span>(defsSchema)</span><br><span class="line">                  .<span class="title function_">compile</span>(schema);</span><br></pre></td></tr></table></div></figure>

<p>See <a href="#options">Options</a> and <a href="#api">addSchema</a> method.</p>
<p><strong>Please note</strong>:</p>
<ul>
<li><code>$ref</code> is resolved as the uri-reference using schema $id as the base URI (see the example).</li>
<li>References can be recursive (and mutually recursive) to implement the schemas for different data structures (such as linked lists, trees, graphs, etc.).</li>
<li>You don’t have to host your schema files at the URIs that you use as schema $id. These URIs are only used to identify the schemas, and according to JSON Schema specification validators should not expect to be able to download the schemas from these URIs.</li>
<li>The actual location of the schema file in the file system is not used.</li>
<li>You can pass the identifier of the schema as the second parameter of <code>addSchema</code> method or as a property name in <code>schemas</code> option. This identifier can be used instead of (or in addition to) schema $id.</li>
<li>You cannot have the same $id (or the schema identifier) used for more than one schema - the exception will be thrown.</li>
<li>You can implement dynamic resolution of the referenced schemas using <code>compileAsync</code> method. In this way you can store schemas in any system (files, web, database, etc.) and reference them without explicitly adding to Ajv instance. See <a href="#asynchronous-schema-compilation">Asynchronous schema compilation</a>.</li>
</ul>

        <h2 id="data-reference"   >
          <a href="#data-reference" class="heading-link"><i class="fas fa-link"></i></a><a href="#data-reference" class="headerlink" title="$data reference"></a>$data reference</h2>
      <p>With <code>$data</code> option you can use values from the validated data as the values for the schema keywords. See <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/json-schema-org/json-schema-spec/issues/51" >proposal</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> for more information about how it works.</p>
<p><code>$data</code> reference is supported in the keywords: const, enum, format, maximum&#x2F;minimum, exclusiveMaximum &#x2F; exclusiveMinimum, maxLength &#x2F; minLength, maxItems &#x2F; minItems, maxProperties &#x2F; minProperties, formatMaximum &#x2F; formatMinimum, formatExclusiveMaximum &#x2F; formatExclusiveMinimum, multipleOf, pattern, required, uniqueItems.</p>
<p>The value of “$data” should be a <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6901" >JSON-pointer</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> to the data (the root is always the top level data object, even if the $data reference is inside a referenced subschema) or a <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://tools.ietf.org/html/draft-luff-relative-json-pointer-00" >relative JSON-pointer</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> (it is relative to the current point in data; if the $data reference is inside a referenced subschema it cannot point to the data outside of the root level for this subschema).</p>
<p>Examples.</p>
<p>This schema requires that the value in property <code>smaller</code> is less or equal than the value in the property larger:</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ajv = <span class="keyword">new</span> <span class="title class_">Ajv</span>(&#123;<span class="attr">$data</span>: <span class="literal">true</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> schema = &#123;</span><br><span class="line">  <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;smaller&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;number&quot;</span>,</span><br><span class="line">      <span class="string">&quot;maximum&quot;</span>: &#123; <span class="string">&quot;$data&quot;</span>: <span class="string">&quot;1/larger&quot;</span> &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;larger&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;number&quot;</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> validData = &#123;</span><br><span class="line">  <span class="attr">smaller</span>: <span class="number">5</span>,</span><br><span class="line">  <span class="attr">larger</span>: <span class="number">7</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ajv.<span class="title function_">validate</span>(schema, validData); <span class="comment">// true</span></span><br></pre></td></tr></table></div></figure>

<p>This schema requires that the properties have the same format as their field names:</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = &#123;</span><br><span class="line">  <span class="string">&quot;additionalProperties&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">    <span class="string">&quot;format&quot;</span>: &#123; <span class="string">&quot;$data&quot;</span>: <span class="string">&quot;0#&quot;</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> validData = &#123;</span><br><span class="line">  <span class="string">&#x27;date-time&#x27;</span>: <span class="string">&#x27;1963-06-19T08:30:06.283185Z&#x27;</span>,</span><br><span class="line">  <span class="attr">email</span>: <span class="string">&#x27;joe.bloggs@example.com&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p><code>$data</code> reference is resolved safely - it won’t throw even if some property is undefined. If <code>$data</code> resolves to <code>undefined</code> the validation succeeds (with the exclusion of <code>const</code> keyword). If <code>$data</code> resolves to incorrect type (e.g. not “number” for maximum keyword) the validation fails.</p>

        <h2 id="merge-and-patch-keywords"   >
          <a href="#merge-and-patch-keywords" class="heading-link"><i class="fas fa-link"></i></a><a href="#merge-and-patch-keywords" class="headerlink" title="$merge and $patch keywords"></a>$merge and $patch keywords</h2>
      <p>With the package <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv-merge-patch" >ajv-merge-patch</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> you can use the keywords <code>$merge</code> and <code>$patch</code> that allow extending JSON Schemas with patches using formats <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7396" >JSON Merge Patch (RFC 7396)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> and <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6902" >JSON Patch (RFC 6902)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>.</p>
<p>To add keywords <code>$merge</code> and <code>$patch</code> to Ajv instance use this code:</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;ajv-merge-patch&#x27;</span>)(ajv);</span><br></pre></td></tr></table></div></figure>

<p>Examples.</p>
<p>Using <code>$merge</code>:</p>
<figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;$merge&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;object&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;p&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;additionalProperties&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;with&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;q&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;number&quot;</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></div></figure>

<p>Using <code>$patch</code>:</p>
<figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;$patch&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;object&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;p&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;additionalProperties&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;with&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span> <span class="attr">&quot;op&quot;</span><span class="punctuation">:</span> <span class="string">&quot;add&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/properties/q&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;number&quot;</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></div></figure>

<p>The schemas above are equivalent to this schema:</p>
<figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;object&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;p&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;q&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;number&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;additionalProperties&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></div></figure>

<p>The properties <code>source</code> and <code>with</code> in the keywords <code>$merge</code> and <code>$patch</code> can use absolute or relative <code>$ref</code> to point to other schemas previously added to the Ajv instance or to the fragments of the current schema.</p>
<p>See the package <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv-merge-patch" >ajv-merge-patch</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> for more information.</p>

        <h2 id="Defining-custom-keywords"   >
          <a href="#Defining-custom-keywords" class="heading-link"><i class="fas fa-link"></i></a><a href="#Defining-custom-keywords" class="headerlink" title="Defining custom keywords"></a>Defining custom keywords</h2>
      <p>The advantages of using custom keywords are:</p>
<ul>
<li>allow creating validation scenarios that cannot be expressed using JSON Schema</li>
<li>simplify your schemas</li>
<li>help bringing a bigger part of the validation logic to your schemas</li>
<li>make your schemas more expressive, less verbose and closer to your application domain</li>
<li>implement custom data processors that modify your data (<code>modifying</code> option MUST be used in keyword definition) and&#x2F;or create side effects while the data is being validated</li>
</ul>
<p>If a keyword is used only for side-effects and its validation result is pre-defined, use option <code>valid: true/false</code> in keyword definition to simplify both generated code (no error handling in case of <code>valid: true</code>) and your keyword functions (no need to return any validation result).</p>
<p>The concerns you have to be aware of when extending JSON Schema standard with custom keywords are the portability and understanding of your schemas. You will have to support these custom keywords on other platforms and to properly document these keywords so that everybody can understand them in your schemas.</p>
<p>You can define custom keywords with <a href="#api-addkeyword">addKeyword</a> method. Keywords are defined on the <code>ajv</code> instance level - new instances will not have previously defined keywords.</p>
<p>Ajv allows defining keywords with:</p>
<ul>
<li>validation function</li>
<li>compilation function</li>
<li>macro function</li>
<li>inline compilation function that should return code (as string) that will be inlined in the currently compiled schema.</li>
</ul>
<p>Example. <code>range</code> and <code>exclusiveRange</code> keywords using compiled schema:</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ajv.<span class="title function_">addKeyword</span>(<span class="string">&#x27;range&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;number&#x27;</span>,</span><br><span class="line">  <span class="attr">compile</span>: <span class="keyword">function</span> (<span class="params">sch, parentSchema</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> min = sch[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">var</span> max = sch[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> parentSchema.<span class="property">exclusiveRange</span> === <span class="literal">true</span></span><br><span class="line">            ? <span class="keyword">function</span> (<span class="params">data</span>) &#123; <span class="keyword">return</span> data &gt; min &amp;&amp; data &lt; max; &#125;</span><br><span class="line">            : <span class="keyword">function</span> (<span class="params">data</span>) &#123; <span class="keyword">return</span> data &gt;= min &amp;&amp; data &lt;= max; &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> schema = &#123; <span class="string">&quot;range&quot;</span>: [<span class="number">2</span>, <span class="number">4</span>], <span class="string">&quot;exclusiveRange&quot;</span>: <span class="literal">true</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> validate = ajv.<span class="title function_">compile</span>(schema);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">validate</span>(<span class="number">2.01</span>)); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">validate</span>(<span class="number">3.99</span>)); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">validate</span>(<span class="number">2</span>)); <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">validate</span>(<span class="number">4</span>)); <span class="comment">// false</span></span><br></pre></td></tr></table></div></figure>

<p>Several custom keywords (typeof, instanceof, range and propertyNames) are defined in <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv-keywords" >ajv-keywords</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> package - they can be used for your schemas and as a starting point for your own custom keywords.</p>
<p>See <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/blob/master/CUSTOM.md" >Defining custom keywords</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> for more details.</p>

        <h2 id="Asynchronous-schema-compilation"   >
          <a href="#Asynchronous-schema-compilation" class="heading-link"><i class="fas fa-link"></i></a><a href="#Asynchronous-schema-compilation" class="headerlink" title="Asynchronous schema compilation"></a>Asynchronous schema compilation</h2>
      <p>During asynchronous compilation remote references are loaded using supplied function. See <code>compileAsync</code> <a href="#api-compileAsync">method</a> and <code>loadSchema</code> <a href="#options">option</a>.</p>
<p>Example:</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ajv = <span class="keyword">new</span> <span class="title class_">Ajv</span>(&#123; <span class="attr">loadSchema</span>: loadSchema &#125;);</span><br><span class="line"></span><br><span class="line">ajv.<span class="title function_">compileAsync</span>(schema).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">validate</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> valid = <span class="title function_">validate</span>(data);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadSchema</span>(<span class="params">uri</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">json</span>(uri).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (res.<span class="property">statusCode</span> &gt;= <span class="number">400</span>)</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Loading error: &#x27;</span> + res.<span class="property">statusCode</span>);</span><br><span class="line">    <span class="keyword">return</span> res.<span class="property">body</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p><strong>Please note</strong>: <a href="#options">Option</a> <code>missingRefs</code> should NOT be set to <code>&quot;ignore&quot;</code> or <code>&quot;fail&quot;</code> for asynchronous compilation to work.</p>

        <h2 id="Asynchronous-validation"   >
          <a href="#Asynchronous-validation" class="heading-link"><i class="fas fa-link"></i></a><a href="#Asynchronous-validation" class="headerlink" title="Asynchronous validation"></a>Asynchronous validation</h2>
      <p>Example in Node.js REPL: <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://tonicdev.com/esp/ajv-asynchronous-validation" >https://tonicdev.com/esp/ajv-asynchronous-validation</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>You can define custom formats and keywords that perform validation asynchronously by accessing database or some other service. You should add <code>async: true</code> in the keyword or format definition (see <a href="#api-addformat">addFormat</a>, <a href="#api-addkeyword">addKeyword</a> and <a href="#defining-custom-keywords">Defining custom keywords</a>).</p>
<p>If your schema uses asynchronous formats&#x2F;keywords or refers to some schema that contains them it should have <code>&quot;$async&quot;: true</code> keyword so that Ajv can compile it correctly. If asynchronous format&#x2F;keyword or reference to asynchronous schema is used in the schema without <code>$async</code> keyword Ajv will throw an exception during schema compilation.</p>
<p><strong>Please note</strong>: all asynchronous subschemas that are referenced from the current or other schemas should have <code>&quot;$async&quot;: true</code> keyword as well, otherwise the schema compilation will fail.</p>
<p>Validation function for an asynchronous custom format&#x2F;keyword should return a promise that resolves with <code>true</code> or <code>false</code> (or rejects with <code>new Ajv.ValidationError(errors)</code> if you want to return custom errors from the keyword function).</p>
<p>Ajv compiles asynchronous schemas to <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://tc39.github.io/ecmascript-asyncawait/" >es7 async functions</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> that can optionally be transpiled with <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/MatAtBread/nodent" >nodent</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>. Async functions are supported in Node.js 7+ and all modern browsers. You can also supply any other transpiler as a function via <code>processCode</code> option. See <a href="#options">Options</a>.</p>
<p>The compiled validation function has <code>$async: true</code> property (if the schema is asynchronous), so you can differentiate these functions if you are using both synchronous and asynchronous schemas.</p>
<p>Validation result will be a promise that resolves with validated data or rejects with an exception <code>Ajv.ValidationError</code> that contains the array of validation errors in <code>errors</code> property.</p>
<p>Example:</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ajv = <span class="keyword">new</span> <span class="title class_">Ajv</span>;</span><br><span class="line"><span class="comment">// require(&#x27;ajv-async&#x27;)(ajv);</span></span><br><span class="line"></span><br><span class="line">ajv.<span class="title function_">addKeyword</span>(<span class="string">&#x27;idExists&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">async</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;number&#x27;</span>,</span><br><span class="line">  <span class="attr">validate</span>: checkIdExists</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">checkIdExists</span>(<span class="params">schema, data</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">knex</span>(schema.<span class="property">table</span>)</span><br><span class="line">  .<span class="title function_">select</span>(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">  .<span class="title function_">where</span>(<span class="string">&#x27;id&#x27;</span>, data)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">rows</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> !!rows.<span class="property">length</span>; <span class="comment">// true if record is found</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> schema = &#123;</span><br><span class="line">  <span class="string">&quot;$async&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;userId&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;integer&quot;</span>,</span><br><span class="line">      <span class="string">&quot;idExists&quot;</span>: &#123; <span class="string">&quot;table&quot;</span>: <span class="string">&quot;users&quot;</span> &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;postId&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;integer&quot;</span>,</span><br><span class="line">      <span class="string">&quot;idExists&quot;</span>: &#123; <span class="string">&quot;table&quot;</span>: <span class="string">&quot;posts&quot;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> validate = ajv.<span class="title function_">compile</span>(schema);</span><br><span class="line"></span><br><span class="line"><span class="title function_">validate</span>(&#123; <span class="attr">userId</span>: <span class="number">1</span>, <span class="attr">postId</span>: <span class="number">19</span> &#125;)</span><br><span class="line">.<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Data is valid&#x27;</span>, data); <span class="comment">// &#123; userId: 1, postId: 19 &#125;</span></span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!(err <span class="keyword">instanceof</span> <span class="title class_">Ajv</span>.<span class="property">ValidationError</span>)) <span class="keyword">throw</span> err;</span><br><span class="line">  <span class="comment">// data is invalid</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Validation errors:&#x27;</span>, err.<span class="property">errors</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></div></figure>


        <h3 id="Using-transpilers-with-asynchronous-validation-functions"   >
          <a href="#Using-transpilers-with-asynchronous-validation-functions" class="heading-link"><i class="fas fa-link"></i></a><a href="#Using-transpilers-with-asynchronous-validation-functions" class="headerlink" title="Using transpilers with asynchronous validation functions."></a>Using transpilers with asynchronous validation functions.</h3>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv-async" >ajv-async</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> uses <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/MatAtBread/nodent" >nodent</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> to transpile async functions. To use another transpiler you should separately install it (or load its bundle in the browser).</p>

        <h4 id="Using-nodent"   >
          <a href="#Using-nodent" class="heading-link"><i class="fas fa-link"></i></a><a href="#Using-nodent" class="headerlink" title="Using nodent"></a>Using nodent</h4>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ajv = <span class="keyword">new</span> <span class="title class_">Ajv</span>;</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;ajv-async&#x27;</span>)(ajv);</span><br><span class="line"><span class="comment">// in the browser if you want to load ajv-async bundle separately you can:</span></span><br><span class="line"><span class="comment">// window.ajvAsync(ajv);</span></span><br><span class="line"><span class="keyword">var</span> validate = ajv.<span class="title function_">compile</span>(schema); <span class="comment">// transpiled es7 async function</span></span><br><span class="line"><span class="title function_">validate</span>(data).<span class="title function_">then</span>(successFunc).<span class="title function_">catch</span>(errorFunc);</span><br></pre></td></tr></table></div></figure>



        <h4 id="Using-other-transpilers"   >
          <a href="#Using-other-transpilers" class="heading-link"><i class="fas fa-link"></i></a><a href="#Using-other-transpilers" class="headerlink" title="Using other transpilers"></a>Using other transpilers</h4>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ajv = <span class="keyword">new</span> <span class="title class_">Ajv</span>(&#123; <span class="attr">processCode</span>: transpileFunc &#125;);</span><br><span class="line"><span class="keyword">var</span> validate = ajv.<span class="title function_">compile</span>(schema); <span class="comment">// transpiled es7 async function</span></span><br><span class="line"><span class="title function_">validate</span>(data).<span class="title function_">then</span>(successFunc).<span class="title function_">catch</span>(errorFunc);</span><br></pre></td></tr></table></div></figure>

<p>See <a href="#options">Options</a>.</p>

        <h2 id="Security-considerations"   >
          <a href="#Security-considerations" class="heading-link"><i class="fas fa-link"></i></a><a href="#Security-considerations" class="headerlink" title="Security considerations"></a>Security considerations</h2>
      <p>JSON Schema, if properly used, can replace data sanitisation. It doesn’t replace other API security considerations. It also introduces additional security aspects to consider.</p>

        <h5 id="Security-contact"   >
          <a href="#Security-contact" class="heading-link"><i class="fas fa-link"></i></a><a href="#Security-contact" class="headerlink" title="Security contact"></a>Security contact</h5>
      <p>To report a security vulnerability, please use the<br><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://tidelift.com/security" >Tidelift security contact</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>.<br>Tidelift will coordinate the fix and disclosure. Please do NOT report security vulnerabilities via GitHub issues.</p>

        <h5 id="Untrusted-schemas"   >
          <a href="#Untrusted-schemas" class="heading-link"><i class="fas fa-link"></i></a><a href="#Untrusted-schemas" class="headerlink" title="Untrusted schemas"></a>Untrusted schemas</h5>
      <p>Ajv treats JSON schemas as trusted as your application code. This security model is based on the most common use case, when the schemas are static and bundled together with the application.</p>
<p>If your schemas are received from untrusted sources (or generated from untrusted data) there are several scenarios you need to prevent:</p>
<ul>
<li>compiling schemas can cause stack overflow (if they are too deep)</li>
<li>compiling schemas can be slow (e.g. <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/issues/557" >#557</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>)</li>
<li>validating certain data can be slow</li>
</ul>
<p>It is difficult to predict all the scenarios, but at the very least it may help to limit the size of untrusted schemas (e.g. limit JSON string length) and also the maximum schema object depth (that can be high for relatively small JSON strings). You also may want to mitigate slow regular expressions in <code>pattern</code> and <code>patternProperties</code> keywords.</p>
<p>Regardless the measures you take, using untrusted schemas increases security risks.</p>

        <h5 id="Circular-references-in-JavaScript-objects"   >
          <a href="#Circular-references-in-JavaScript-objects" class="heading-link"><i class="fas fa-link"></i></a><a href="#Circular-references-in-JavaScript-objects" class="headerlink" title="Circular references in JavaScript objects"></a>Circular references in JavaScript objects</h5>
      <p>Ajv does not support schemas and validated data that have circular references in objects. See <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/issues/802" >issue #802</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>.</p>
<p>An attempt to compile such schemas or validate such data would cause stack overflow (or will not complete in case of asynchronous validation). Depending on the parser you use, untrusted data can lead to circular references.</p>

        <h5 id="Security-risks-of-trusted-schemas"   >
          <a href="#Security-risks-of-trusted-schemas" class="heading-link"><i class="fas fa-link"></i></a><a href="#Security-risks-of-trusted-schemas" class="headerlink" title="Security risks of trusted schemas"></a>Security risks of trusted schemas</h5>
      <p>Some keywords in JSON Schemas can lead to very slow validation for certain data. These keywords include (but may be not limited to):</p>
<ul>
<li><code>pattern</code> and <code>format</code> for large strings - in some cases using <code>maxLength</code> can help mitigate it, but certain regular expressions can lead to exponential validation time even with relatively short strings (see <a href="#redos-attack">ReDoS attack</a>).</li>
<li><code>patternProperties</code> for large property names - use <code>propertyNames</code> to mitigate, but some regular expressions can have exponential evaluation time as well.</li>
<li><code>uniqueItems</code> for large non-scalar arrays - use <code>maxItems</code> to mitigate</li>
</ul>
<p><strong>Please note</strong>: The suggestions above to prevent slow validation would only work if you do NOT use <code>allErrors: true</code> in production code (using it would continue validation after validation errors).</p>
<p>You can validate your JSON schemas against <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/blob/master/lib/refs/json-schema-secure.json" >this meta-schema</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> to check that these recommendations are followed:</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isSchemaSecure = ajv.<span class="title function_">compile</span>(<span class="built_in">require</span>(<span class="string">&#x27;ajv/lib/refs/json-schema-secure.json&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> schema1 = &#123;<span class="attr">format</span>: <span class="string">&#x27;email&#x27;</span>&#125;;</span><br><span class="line"><span class="title function_">isSchemaSecure</span>(schema1); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> schema2 = &#123;<span class="attr">format</span>: <span class="string">&#x27;email&#x27;</span>, <span class="attr">maxLength</span>: <span class="variable constant_">MAX_LENGTH</span>&#125;;</span><br><span class="line"><span class="title function_">isSchemaSecure</span>(schema2); <span class="comment">// true</span></span><br></pre></td></tr></table></div></figure>

<p><strong>Please note</strong>: following all these recommendation is not a guarantee that validation of untrusted data is safe - it can still lead to some undesirable results.</p>

        <h5 id="Content-Security-Policies-CSP"   >
          <a href="#Content-Security-Policies-CSP" class="heading-link"><i class="fas fa-link"></i></a><a href="#Content-Security-Policies-CSP" class="headerlink" title="Content Security Policies (CSP)"></a>Content Security Policies (CSP)</h5>
      <p>See <a href="#ajv-and-content-security-policies-csp">Ajv and Content Security Policies (CSP)</a></p>

        <h2 id="ReDoS-attack"   >
          <a href="#ReDoS-attack" class="heading-link"><i class="fas fa-link"></i></a><a href="#ReDoS-attack" class="headerlink" title="ReDoS attack"></a>ReDoS attack</h2>
      <p>Certain regular expressions can lead to the exponential evaluation time even with relatively short strings.</p>
<p>Please assess the regular expressions you use in the schemas on their vulnerability to this attack - see <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/substack/safe-regex" >safe-regex</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>, for example.</p>
<p><strong>Please note</strong>: some formats that Ajv implements use <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/blob/master/lib/compile/formats.js" >regular expressions</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> that can be vulnerable to ReDoS attack, so if you use Ajv to validate data from untrusted sources <strong>it is strongly recommended</strong> to consider the following:</p>
<ul>
<li>making assessment of “format” implementations in Ajv.</li>
<li>using <code>format: &#39;fast&#39;</code> option that simplifies some of the regular expressions (although it does not guarantee that they are safe).</li>
<li>replacing format implementations provided by Ajv with your own implementations of “format” keyword that either uses different regular expressions or another approach to format validation. Please see <a href="#api-addformat">addFormat</a> method.</li>
<li>disabling format validation by ignoring “format” keyword with option <code>format: false</code></li>
</ul>
<p>Whatever mitigation you choose, please assume all formats provided by Ajv as potentially unsafe and make your own assessment of their suitability for your validation scenarios.</p>

        <h2 id="Filtering-data"   >
          <a href="#Filtering-data" class="heading-link"><i class="fas fa-link"></i></a><a href="#Filtering-data" class="headerlink" title="Filtering data"></a>Filtering data</h2>
      <p>With <a href="#options">option <code>removeAdditional</code></a> (added by <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/andyscott" >andyscott</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>) you can filter data during the validation.</p>
<p>This option modifies original data.</p>
<p>Example:</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ajv = <span class="keyword">new</span> <span class="title class_">Ajv</span>(&#123; <span class="attr">removeAdditional</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> schema = &#123;</span><br><span class="line">  <span class="string">&quot;additionalProperties&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;foo&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;number&quot;</span> &#125;,</span><br><span class="line">    <span class="string">&quot;bar&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;additionalProperties&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;number&quot;</span> &#125;,</span><br><span class="line">      <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;baz&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> data = &#123;</span><br><span class="line">  <span class="string">&quot;foo&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="string">&quot;additional1&quot;</span>: <span class="number">1</span>, <span class="comment">// will be removed; `additionalProperties` == false</span></span><br><span class="line">  <span class="string">&quot;bar&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;baz&quot;</span>: <span class="string">&quot;abc&quot;</span>,</span><br><span class="line">    <span class="string">&quot;additional2&quot;</span>: <span class="number">2</span> <span class="comment">// will NOT be removed; `additionalProperties` != false</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> validate = ajv.<span class="title function_">compile</span>(schema);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">validate</span>(data)); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(data); <span class="comment">// &#123; &quot;foo&quot;: 0, &quot;bar&quot;: &#123; &quot;baz&quot;: &quot;abc&quot;, &quot;additional2&quot;: 2 &#125;</span></span><br></pre></td></tr></table></div></figure>

<p>If <code>removeAdditional</code> option in the example above were <code>&quot;all&quot;</code> then both <code>additional1</code> and <code>additional2</code> properties would have been removed.</p>
<p>If the option were <code>&quot;failing&quot;</code> then property <code>additional1</code> would have been removed regardless of its value and property <code>additional2</code> would have been removed only if its value were failing the schema in the inner <code>additionalProperties</code> (so in the example above it would have stayed because it passes the schema, but any non-number would have been removed).</p>
<p><strong>Please note</strong>: If you use <code>removeAdditional</code> option with <code>additionalProperties</code> keyword inside <code>anyOf</code>&#x2F;<code>oneOf</code> keywords your validation can fail with this schema, for example:</p>
<figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;object&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;oneOf&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;foo&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;required&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">&quot;foo&quot;</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;additionalProperties&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;bar&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;required&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">&quot;bar&quot;</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;additionalProperties&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></div></figure>

<p>The intention of the schema above is to allow objects with either the string property “foo” or the integer property “bar”, but not with both and not with any other properties.</p>
<p>With the option <code>removeAdditional: true</code> the validation will pass for the object <code>&#123; &quot;foo&quot;: &quot;abc&quot;&#125;</code> but will fail for the object <code>&#123;&quot;bar&quot;: 1&#125;</code>. It happens because while the first subschema in <code>oneOf</code> is validated, the property <code>bar</code> is removed because it is an additional property according to the standard (because it is not included in <code>properties</code> keyword in the same schema).</p>
<p>While this behaviour is unexpected (issues <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/issues/129" >#129</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>, <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/issues/134" >#134</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>), it is correct. To have the expected behaviour (both objects are allowed and additional properties are removed) the schema has to be refactored in this way:</p>
<figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;object&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;foo&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;bar&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;additionalProperties&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;oneOf&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;required&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">&quot;foo&quot;</span> <span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;required&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">&quot;bar&quot;</span> <span class="punctuation">]</span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></div></figure>

<p>The schema above is also more efficient - it will compile into a faster function.</p>

        <h2 id="Assigning-defaults"   >
          <a href="#Assigning-defaults" class="heading-link"><i class="fas fa-link"></i></a><a href="#Assigning-defaults" class="headerlink" title="Assigning defaults"></a>Assigning defaults</h2>
      <p>With <a href="#options">option <code>useDefaults</code></a> Ajv will assign values from <code>default</code> keyword in the schemas of <code>properties</code> and <code>items</code> (when it is the array of schemas) to the missing properties and items.</p>
<p>With the option value <code>&quot;empty&quot;</code> properties and items equal to <code>null</code> or <code>&quot;&quot;</code> (empty string) will be considered missing and assigned defaults.</p>
<p>This option modifies original data.</p>
<p><strong>Please note</strong>: the default value is inserted in the generated validation code as a literal, so the value inserted in the data will be the deep clone of the default in the schema.</p>
<p>Example 1 (<code>default</code> in <code>properties</code>):</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ajv = <span class="keyword">new</span> <span class="title class_">Ajv</span>(&#123; <span class="attr">useDefaults</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> schema = &#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;object&quot;</span>,</span><br><span class="line">  <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;foo&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;number&quot;</span> &#125;,</span><br><span class="line">    <span class="string">&quot;bar&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>, <span class="string">&quot;default&quot;</span>: <span class="string">&quot;baz&quot;</span> &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;required&quot;</span>: [ <span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span> ]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> data = &#123; <span class="string">&quot;foo&quot;</span>: <span class="number">1</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> validate = ajv.<span class="title function_">compile</span>(schema);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">validate</span>(data)); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(data); <span class="comment">// &#123; &quot;foo&quot;: 1, &quot;bar&quot;: &quot;baz&quot; &#125;</span></span><br></pre></td></tr></table></div></figure>

<p>Example 2 (<code>default</code> in <code>items</code>):</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = &#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;array&quot;</span>,</span><br><span class="line">  <span class="string">&quot;items&quot;</span>: [</span><br><span class="line">    &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;number&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>, <span class="string">&quot;default&quot;</span>: <span class="string">&quot;foo&quot;</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> data = [ <span class="number">1</span> ];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> validate = ajv.<span class="title function_">compile</span>(schema);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">validate</span>(data)); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(data); <span class="comment">// [ 1, &quot;foo&quot; ]</span></span><br></pre></td></tr></table></div></figure>

<p><code>default</code> keywords in other cases are ignored:</p>
<ul>
<li>not in <code>properties</code> or <code>items</code> subschemas</li>
<li>in schemas inside <code>anyOf</code>, <code>oneOf</code> and <code>not</code> (see <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/issues/42" >#42</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>)</li>
<li>in <code>if</code> subschema of <code>switch</code> keyword</li>
<li>in schemas generated by custom macro keywords</li>
</ul>
<p>The <a href="#options"><code>strictDefaults</code> option</a> customizes Ajv’s behavior for the defaults that Ajv ignores (<code>true</code> raises an error, and <code>&quot;log&quot;</code> outputs a warning).</p>

        <h2 id="Coercing-data-types"   >
          <a href="#Coercing-data-types" class="heading-link"><i class="fas fa-link"></i></a><a href="#Coercing-data-types" class="headerlink" title="Coercing data types"></a>Coercing data types</h2>
      <p>When you are validating user inputs all your data properties are usually strings. The option <code>coerceTypes</code> allows you to have your data types coerced to the types specified in your schema <code>type</code> keywords, both to pass the validation and to use the correctly typed data afterwards.</p>
<p>This option modifies original data.</p>
<p><strong>Please note</strong>: if you pass a scalar value to the validating function its type will be coerced and it will pass the validation, but the value of the variable you pass won’t be updated because scalars are passed by value.</p>
<p>Example 1:</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ajv = <span class="keyword">new</span> <span class="title class_">Ajv</span>(&#123; <span class="attr">coerceTypes</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> schema = &#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;object&quot;</span>,</span><br><span class="line">  <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;foo&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;number&quot;</span> &#125;,</span><br><span class="line">    <span class="string">&quot;bar&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;boolean&quot;</span> &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;required&quot;</span>: [ <span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span> ]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> data = &#123; <span class="string">&quot;foo&quot;</span>: <span class="string">&quot;1&quot;</span>, <span class="string">&quot;bar&quot;</span>: <span class="string">&quot;false&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> validate = ajv.<span class="title function_">compile</span>(schema);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">validate</span>(data)); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(data); <span class="comment">// &#123; &quot;foo&quot;: 1, &quot;bar&quot;: false &#125;</span></span><br></pre></td></tr></table></div></figure>

<p>Example 2 (array coercions):</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ajv = <span class="keyword">new</span> <span class="title class_">Ajv</span>(&#123; <span class="attr">coerceTypes</span>: <span class="string">&#x27;array&#x27;</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> schema = &#123;</span><br><span class="line">  <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;foo&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;array&quot;</span>, <span class="string">&quot;items&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;number&quot;</span> &#125; &#125;,</span><br><span class="line">    <span class="string">&quot;bar&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;boolean&quot;</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> data = &#123; <span class="string">&quot;foo&quot;</span>: <span class="string">&quot;1&quot;</span>, <span class="string">&quot;bar&quot;</span>: [<span class="string">&quot;false&quot;</span>] &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> validate = ajv.<span class="title function_">compile</span>(schema);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">validate</span>(data)); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(data); <span class="comment">// &#123; &quot;foo&quot;: [1], &quot;bar&quot;: false &#125;</span></span><br></pre></td></tr></table></div></figure>

<p>The coercion rules, as you can see from the example, are different from JavaScript both to validate user input as expected and to have the coercion reversible (to correctly validate cases where different types are defined in subschemas of “anyOf” and other compound keywords).</p>
<p>See <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/blob/master/COERCION.md" >Coercion rules</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> for details.</p>

        <h2 id="API"   >
          <a href="#API" class="heading-link"><i class="fas fa-link"></i></a><a href="#API" class="headerlink" title="API"></a>API</h2>
      
        <h5 id="new-Ajv-Object-options-gt-Object"   >
          <a href="#new-Ajv-Object-options-gt-Object" class="heading-link"><i class="fas fa-link"></i></a><a href="#new-Ajv-Object-options-gt-Object" class="headerlink" title="new Ajv(Object options) -&gt; Object"></a>new Ajv(Object options) -&gt; Object</h5>
      <p>Create Ajv instance.</p>

        <h5 id="compile-Object-schema-gt-Function-lt-Object-data-gt"   >
          <a href="#compile-Object-schema-gt-Function-lt-Object-data-gt" class="heading-link"><i class="fas fa-link"></i></a><a href="#compile-Object-schema-gt-Function-lt-Object-data-gt" class="headerlink" title=".compile(Object schema) -&gt; Function&lt;Object data&gt;"></a>.compile(Object schema) -&gt; Function&lt;Object data&gt;</h5>
      <p>Generate validating function and cache the compiled schema for future use.</p>
<p>Validating function returns a boolean value. This function has properties <code>errors</code> and <code>schema</code>. Errors encountered during the last validation are assigned to <code>errors</code> property (it is assigned <code>null</code> if there was no errors). <code>schema</code> property contains the reference to the original schema.</p>
<p>The schema passed to this method will be validated against meta-schema unless <code>validateSchema</code> option is false. If schema is invalid, an error will be thrown. See <a href="#options">options</a>.</p>

        <h5 id="compileAsync-Object-schema-Boolean-meta-Function-callback-gt-Promise"   >
          <a href="#compileAsync-Object-schema-Boolean-meta-Function-callback-gt-Promise" class="heading-link"><i class="fas fa-link"></i></a><a href="#compileAsync-Object-schema-Boolean-meta-Function-callback-gt-Promise" class="headerlink" title=".compileAsync(Object schema [, Boolean meta] [, Function callback]) -&gt; Promise"></a><a name="api-compileAsync"></a>.compileAsync(Object schema [, Boolean meta] [, Function callback]) -&gt; Promise</h5>
      <p>Asynchronous version of <code>compile</code> method that loads missing remote schemas using asynchronous function in <code>options.loadSchema</code>. This function returns a Promise that resolves to a validation function. An optional callback passed to <code>compileAsync</code> will be called with 2 parameters: error (or null) and validating function. The returned promise will reject (and the callback will be called with an error) when:</p>
<ul>
<li>missing schema can’t be loaded (<code>loadSchema</code> returns a Promise that rejects).</li>
<li>a schema containing a missing reference is loaded, but the reference cannot be resolved.</li>
<li>schema (or some loaded&#x2F;referenced schema) is invalid.</li>
</ul>
<p>The function compiles schema and loads the first missing schema (or meta-schema) until all missing schemas are loaded.</p>
<p>You can asynchronously compile meta-schema by passing <code>true</code> as the second parameter.</p>
<p>See example in <a href="#asynchronous-schema-compilation">Asynchronous compilation</a>.</p>

        <h5 id="validate-Object-schema-String-key-String-ref-data-gt-Boolean"   >
          <a href="#validate-Object-schema-String-key-String-ref-data-gt-Boolean" class="heading-link"><i class="fas fa-link"></i></a><a href="#validate-Object-schema-String-key-String-ref-data-gt-Boolean" class="headerlink" title=".validate(Object schema|String key|String ref, data) -&gt; Boolean"></a>.validate(Object schema|String key|String ref, data) -&gt; Boolean</h5>
      <p>Validate data using passed schema (it will be compiled and cached).</p>
<p>Instead of the schema you can use the key that was previously passed to <code>addSchema</code>, the schema id if it was present in the schema or any previously resolved reference.</p>
<p>Validation errors will be available in the <code>errors</code> property of Ajv instance (<code>null</code> if there were no errors).</p>
<p><strong>Please note</strong>: every time this method is called the errors are overwritten so you need to copy them to another variable if you want to use them later.</p>
<p>If the schema is asynchronous (has <code>$async</code> keyword on the top level) this method returns a Promise. See <a href="#asynchronous-validation">Asynchronous validation</a>.</p>

        <h5 id="addSchema-Array-lt-Object-gt-Object-schema-String-key-gt-Ajv"   >
          <a href="#addSchema-Array-lt-Object-gt-Object-schema-String-key-gt-Ajv" class="heading-link"><i class="fas fa-link"></i></a><a href="#addSchema-Array-lt-Object-gt-Object-schema-String-key-gt-Ajv" class="headerlink" title=".addSchema(Array&lt;Object&gt;|Object schema [, String key]) -&gt; Ajv"></a>.addSchema(Array&lt;Object&gt;|Object schema [, String key]) -&gt; Ajv</h5>
      <p>Add schema(s) to validator instance. This method does not compile schemas (but it still validates them). Because of that dependencies can be added in any order and circular dependencies are supported. It also prevents unnecessary compilation of schemas that are containers for other schemas but not used as a whole.</p>
<p>Array of schemas can be passed (schemas should have ids), the second parameter will be ignored.</p>
<p>Key can be passed that can be used to reference the schema and will be used as the schema id if there is no id inside the schema. If the key is not passed, the schema id will be used as the key.</p>
<p>Once the schema is added, it (and all the references inside it) can be referenced in other schemas and used to validate data.</p>
<p>Although <code>addSchema</code> does not compile schemas, explicit compilation is not required - the schema will be compiled when it is used first time.</p>
<p>By default the schema is validated against meta-schema before it is added, and if the schema does not pass validation the exception is thrown. This behaviour is controlled by <code>validateSchema</code> option.</p>
<p><strong>Please note</strong>: Ajv uses the <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Method_chaining" >method chaining syntax</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> for all methods with the prefix <code>add*</code> and <code>remove*</code>.<br>This allows you to do nice things like the following.</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> validate = <span class="keyword">new</span> <span class="title class_">Ajv</span>().<span class="title function_">addSchema</span>(schema).<span class="title function_">addFormat</span>(name, regex).<span class="title function_">getSchema</span>(uri);</span><br></pre></td></tr></table></div></figure>


        <h5 id="addMetaSchema-Array-lt-Object-gt-Object-schema-String-key-gt-Ajv"   >
          <a href="#addMetaSchema-Array-lt-Object-gt-Object-schema-String-key-gt-Ajv" class="heading-link"><i class="fas fa-link"></i></a><a href="#addMetaSchema-Array-lt-Object-gt-Object-schema-String-key-gt-Ajv" class="headerlink" title=".addMetaSchema(Array&lt;Object&gt;|Object schema [, String key]) -&gt; Ajv"></a>.addMetaSchema(Array&lt;Object&gt;|Object schema [, String key]) -&gt; Ajv</h5>
      <p>Adds meta schema(s) that can be used to validate other schemas. That function should be used instead of <code>addSchema</code> because there may be instance options that would compile a meta schema incorrectly (at the moment it is <code>removeAdditional</code> option).</p>
<p>There is no need to explicitly add draft-07 meta schema (<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://json-schema.org/draft-07/schema" >http://json-schema.org/draft-07/schema</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>) - it is added by default, unless option <code>meta</code> is set to <code>false</code>. You only need to use it if you have a changed meta-schema that you want to use to validate your schemas. See <code>validateSchema</code>.</p>

        <h5 id="validateSchema-Object-schema-gt-Boolean"   >
          <a href="#validateSchema-Object-schema-gt-Boolean" class="heading-link"><i class="fas fa-link"></i></a><a href="#validateSchema-Object-schema-gt-Boolean" class="headerlink" title=".validateSchema(Object schema) -&gt; Boolean"></a><a name="api-validateschema"></a>.validateSchema(Object schema) -&gt; Boolean</h5>
      <p>Validates schema. This method should be used to validate schemas rather than <code>validate</code> due to the inconsistency of <code>uri</code> format in JSON Schema standard.</p>
<p>By default this method is called automatically when the schema is added, so you rarely need to use it directly.</p>
<p>If schema doesn’t have <code>$schema</code> property, it is validated against draft 6 meta-schema (option <code>meta</code> should not be false).</p>
<p>If schema has <code>$schema</code> property, then the schema with this id (that should be previously added) is used to validate passed schema.</p>
<p>Errors will be available at <code>ajv.errors</code>.</p>

        <h5 id="getSchema-String-key-gt-Function-lt-Object-data-gt"   >
          <a href="#getSchema-String-key-gt-Function-lt-Object-data-gt" class="heading-link"><i class="fas fa-link"></i></a><a href="#getSchema-String-key-gt-Function-lt-Object-data-gt" class="headerlink" title=".getSchema(String key) -&gt; Function&lt;Object data&gt;"></a>.getSchema(String key) -&gt; Function&lt;Object data&gt;</h5>
      <p>Retrieve compiled schema previously added with <code>addSchema</code> by the key passed to <code>addSchema</code> or by its full reference (id). The returned validating function has <code>schema</code> property with the reference to the original schema.</p>

        <h5 id="removeSchema-Object-schema-String-key-String-ref-RegExp-pattern-gt-Ajv"   >
          <a href="#removeSchema-Object-schema-String-key-String-ref-RegExp-pattern-gt-Ajv" class="heading-link"><i class="fas fa-link"></i></a><a href="#removeSchema-Object-schema-String-key-String-ref-RegExp-pattern-gt-Ajv" class="headerlink" title=".removeSchema([Object schema|String key|String ref|RegExp pattern]) -&gt; Ajv"></a>.removeSchema([Object schema|String key|String ref|RegExp pattern]) -&gt; Ajv</h5>
      <p>Remove added&#x2F;cached schema. Even if schema is referenced by other schemas it can be safely removed as dependent schemas have local references.</p>
<p>Schema can be removed using:</p>
<ul>
<li>key passed to <code>addSchema</code></li>
<li>it’s full reference (id)</li>
<li>RegExp that should match schema id or key (meta-schemas won’t be removed)</li>
<li>actual schema object that will be stable-stringified to remove schema from cache</li>
</ul>
<p>If no parameter is passed all schemas but meta-schemas will be removed and the cache will be cleared.</p>

        <h5 id="addFormat-String-name-String-RegExp-Function-Object-format-gt-Ajv"   >
          <a href="#addFormat-String-name-String-RegExp-Function-Object-format-gt-Ajv" class="heading-link"><i class="fas fa-link"></i></a><a href="#addFormat-String-name-String-RegExp-Function-Object-format-gt-Ajv" class="headerlink" title=".addFormat(String name, String|RegExp|Function|Object format) -&gt; Ajv"></a><a name="api-addformat"></a>.addFormat(String name, String|RegExp|Function|Object format) -&gt; Ajv</h5>
      <p>Add custom format to validate strings or numbers. It can also be used to replace pre-defined formats for Ajv instance.</p>
<p>Strings are converted to RegExp.</p>
<p>Function should return validation result as <code>true</code> or <code>false</code>.</p>
<p>If object is passed it should have properties <code>validate</code>, <code>compare</code> and <code>async</code>:</p>
<ul>
<li><em>validate</em>: a string, RegExp or a function as described above.</li>
<li><em>compare</em>: an optional comparison function that accepts two strings and compares them according to the format meaning. This function is used with keywords <code>formatMaximum</code>&#x2F;<code>formatMinimum</code> (defined in <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv-keywords" >ajv-keywords</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> package). It should return <code>1</code> if the first value is bigger than the second value, <code>-1</code> if it is smaller and <code>0</code> if it is equal.</li>
<li><em>async</em>: an optional <code>true</code> value if <code>validate</code> is an asynchronous function; in this case it should return a promise that resolves with a value <code>true</code> or <code>false</code>.</li>
<li><em>type</em>: an optional type of data that the format applies to. It can be <code>&quot;string&quot;</code> (default) or <code>&quot;number&quot;</code> (see <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/issues/291#issuecomment-259923858" >https://github.com/ajv-validator/ajv/issues/291#issuecomment-259923858</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>). If the type of data is different, the validation will pass.</li>
</ul>
<p>Custom formats can be also added via <code>formats</code> option.</p>

        <h5 id="addKeyword-String-keyword-Object-definition-gt-Ajv"   >
          <a href="#addKeyword-String-keyword-Object-definition-gt-Ajv" class="heading-link"><i class="fas fa-link"></i></a><a href="#addKeyword-String-keyword-Object-definition-gt-Ajv" class="headerlink" title=".addKeyword(String keyword, Object definition) -&gt; Ajv"></a><a name="api-addkeyword"></a>.addKeyword(String keyword, Object definition) -&gt; Ajv</h5>
      <p>Add custom validation keyword to Ajv instance.</p>
<p>Keyword should be different from all standard JSON Schema keywords and different from previously defined keywords. There is no way to redefine keywords or to remove keyword definition from the instance.</p>
<p>Keyword must start with a letter, <code>_</code> or <code>$</code>, and may continue with letters, numbers, <code>_</code>, <code>$</code>, or <code>-</code>.<br>It is recommended to use an application-specific prefix for keywords to avoid current and future name collisions.</p>
<p>Example Keywords:</p>
<ul>
<li><code>&quot;xyz-example&quot;</code>: valid, and uses prefix for the xyz project to avoid name collisions.</li>
<li><code>&quot;example&quot;</code>: valid, but not recommended as it could collide with future versions of JSON Schema etc.</li>
<li><code>&quot;3-example&quot;</code>: invalid as numbers are not allowed to be the first character in a keyword</li>
</ul>
<p>Keyword definition is an object with the following properties:</p>
<ul>
<li><em>type</em>: optional string or array of strings with data type(s) that the keyword applies to. If not present, the keyword will apply to all types.</li>
<li><em>validate</em>: validating function</li>
<li><em>compile</em>: compiling function</li>
<li><em>macro</em>: macro function</li>
<li><em>inline</em>: compiling function that returns code (as string)</li>
<li><em>schema</em>: an optional <code>false</code> value used with “validate” keyword to not pass schema</li>
<li><em>metaSchema</em>: an optional meta-schema for keyword schema</li>
<li><em>dependencies</em>: an optional list of properties that must be present in the parent schema - it will be checked during schema compilation</li>
<li><em>modifying</em>: <code>true</code> MUST be passed if keyword modifies data</li>
<li><em>statements</em>: <code>true</code> can be passed in case inline keyword generates statements (as opposed to expression)</li>
<li><em>valid</em>: pass <code>true</code>&#x2F;<code>false</code> to pre-define validation result, the result returned from validation function will be ignored. This option cannot be used with macro keywords.</li>
<li><em>$data</em>: an optional <code>true</code> value to support <a href="#data-reference">$data reference</a> as the value of custom keyword. The reference will be resolved at validation time. If the keyword has meta-schema it would be extended to allow $data and it will be used to validate the resolved value. Supporting $data reference requires that keyword has validating function (as the only option or in addition to compile, macro or inline function).</li>
<li><em>async</em>: an optional <code>true</code> value if the validation function is asynchronous (whether it is compiled or passed in <em>validate</em> property); in this case it should return a promise that resolves with a value <code>true</code> or <code>false</code>. This option is ignored in case of “macro” and “inline” keywords.</li>
<li><em>errors</em>: an optional boolean or string <code>&quot;full&quot;</code> indicating whether keyword returns errors. If this property is not set Ajv will determine if the errors were set in case of failed validation.</li>
</ul>
<p><em>compile</em>, <em>macro</em> and <em>inline</em> are mutually exclusive, only one should be used at a time. <em>validate</em> can be used separately or in addition to them to support $data reference.</p>
<p><strong>Please note</strong>: If the keyword is validating data type that is different from the type(s) in its definition, the validation function will not be called (and expanded macro will not be used), so there is no need to check for data type inside validation function or inside schema returned by macro function (unless you want to enforce a specific type and for some reason do not want to use a separate <code>type</code> keyword for that). In the same way as standard keywords work, if the keyword does not apply to the data type being validated, the validation of this keyword will succeed.</p>
<p>See <a href="#defining-custom-keywords">Defining custom keywords</a> for more details.</p>

        <h5 id="getKeyword-String-keyword-gt-Object-Boolean"   >
          <a href="#getKeyword-String-keyword-gt-Object-Boolean" class="heading-link"><i class="fas fa-link"></i></a><a href="#getKeyword-String-keyword-gt-Object-Boolean" class="headerlink" title=".getKeyword(String keyword) -&gt; Object|Boolean"></a>.getKeyword(String keyword) -&gt; Object|Boolean</h5>
      <p>Returns custom keyword definition, <code>true</code> for pre-defined keywords and <code>false</code> if the keyword is unknown.</p>

        <h5 id="removeKeyword-String-keyword-gt-Ajv"   >
          <a href="#removeKeyword-String-keyword-gt-Ajv" class="heading-link"><i class="fas fa-link"></i></a><a href="#removeKeyword-String-keyword-gt-Ajv" class="headerlink" title=".removeKeyword(String keyword) -&gt; Ajv"></a>.removeKeyword(String keyword) -&gt; Ajv</h5>
      <p>Removes custom or pre-defined keyword so you can redefine them.</p>
<p>While this method can be used to extend pre-defined keywords, it can also be used to completely change their meaning - it may lead to unexpected results.</p>
<p><strong>Please note</strong>: schemas compiled before the keyword is removed will continue to work without changes. To recompile schemas use <code>removeSchema</code> method and compile them again.</p>

        <h5 id="errorsText-Array-lt-Object-gt-errors-Object-options-gt-String"   >
          <a href="#errorsText-Array-lt-Object-gt-errors-Object-options-gt-String" class="heading-link"><i class="fas fa-link"></i></a><a href="#errorsText-Array-lt-Object-gt-errors-Object-options-gt-String" class="headerlink" title=".errorsText([Array&lt;Object&gt; errors [, Object options]]) -&gt; String"></a>.errorsText([Array&lt;Object&gt; errors [, Object options]]) -&gt; String</h5>
      <p>Returns the text with all errors in a String.</p>
<p>Options can have properties <code>separator</code> (string used to separate errors, “, “ by default) and <code>dataVar</code> (the variable name that dataPaths are prefixed with, “data” by default).</p>

        <h2 id="Options"   >
          <a href="#Options" class="heading-link"><i class="fas fa-link"></i></a><a href="#Options" class="headerlink" title="Options"></a>Options</h2>
      <p>Defaults:</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// validation and reporting options:</span></span><br><span class="line">  <span class="attr">$data</span>:            <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">allErrors</span>:        <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">verbose</span>:          <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">$comment</span>:         <span class="literal">false</span>, <span class="comment">// NEW in Ajv version 6.0</span></span><br><span class="line">  <span class="attr">jsonPointers</span>:     <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">uniqueItems</span>:      <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">unicode</span>:          <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">nullable</span>:         <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">format</span>:           <span class="string">&#x27;fast&#x27;</span>,</span><br><span class="line">  <span class="attr">formats</span>:          &#123;&#125;,</span><br><span class="line">  <span class="attr">unknownFormats</span>:   <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">schemas</span>:          &#123;&#125;,</span><br><span class="line">  <span class="attr">logger</span>:           <span class="literal">undefined</span>,</span><br><span class="line">  <span class="comment">// referenced schema options:</span></span><br><span class="line">  <span class="attr">schemaId</span>:         <span class="string">&#x27;$id&#x27;</span>,</span><br><span class="line">  <span class="attr">missingRefs</span>:      <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">extendRefs</span>:       <span class="string">&#x27;ignore&#x27;</span>, <span class="comment">// recommended &#x27;fail&#x27;</span></span><br><span class="line">  <span class="attr">loadSchema</span>:       <span class="literal">undefined</span>, <span class="comment">// function(uri: string): Promise &#123;&#125;</span></span><br><span class="line">  <span class="comment">// options to modify validated data:</span></span><br><span class="line">  <span class="attr">removeAdditional</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">useDefaults</span>:      <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">coerceTypes</span>:      <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// strict mode options</span></span><br><span class="line">  <span class="attr">strictDefaults</span>:   <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">strictKeywords</span>:   <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">strictNumbers</span>:    <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// asynchronous validation options:</span></span><br><span class="line">  <span class="attr">transpile</span>:        <span class="literal">undefined</span>, <span class="comment">// requires ajv-async package</span></span><br><span class="line">  <span class="comment">// advanced options:</span></span><br><span class="line">  <span class="attr">meta</span>:             <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">validateSchema</span>:   <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">addUsedSchema</span>:    <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">inlineRefs</span>:       <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">passContext</span>:      <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">loopRequired</span>:     <span class="title class_">Infinity</span>,</span><br><span class="line">  <span class="attr">ownProperties</span>:    <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">multipleOfPrecision</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">errorDataPath</span>:    <span class="string">&#x27;object&#x27;</span>, <span class="comment">// deprecated</span></span><br><span class="line">  <span class="attr">messages</span>:         <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">sourceCode</span>:       <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">processCode</span>:      <span class="literal">undefined</span>, <span class="comment">// function (str: string, schema: object): string &#123;&#125;</span></span><br><span class="line">  <span class="attr">cache</span>:            <span class="keyword">new</span> <span class="title class_">Cache</span>,</span><br><span class="line">  <span class="attr">serialize</span>:        <span class="literal">undefined</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="Validation-and-reporting-options"   >
          <a href="#Validation-and-reporting-options" class="heading-link"><i class="fas fa-link"></i></a><a href="#Validation-and-reporting-options" class="headerlink" title="Validation and reporting options"></a>Validation and reporting options</h5>
      <ul>
<li><em>$data</em>: support <a href="#data-reference">$data references</a>. Draft 6 meta-schema that is added by default will be extended to allow them. If you want to use another meta-schema you need to use $dataMetaSchema method to add support for $data reference. See <a href="#api">API</a>.</li>
<li><em>allErrors</em>: check all rules collecting all errors. Default is to return after the first error.</li>
<li><em>verbose</em>: include the reference to the part of the schema (<code>schema</code> and <code>parentSchema</code>) and validated data in errors (false by default).</li>
<li><em>$comment</em> (NEW in Ajv version 6.0): log or pass the value of <code>$comment</code> keyword to a function. Option values:<ul>
<li><code>false</code> (default): ignore $comment keyword.</li>
<li><code>true</code>: log the keyword value to console.</li>
<li>function: pass the keyword value, its schema path and root schema to the specified function</li>
</ul>
</li>
<li><em>jsonPointers</em>: set <code>dataPath</code> property of errors using <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6901" >JSON Pointers</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> instead of JavaScript property access notation.</li>
<li><em>uniqueItems</em>: validate <code>uniqueItems</code> keyword (true by default).</li>
<li><em>unicode</em>: calculate correct length of strings with unicode pairs (true by default). Pass <code>false</code> to use <code>.length</code> of strings that is faster, but gives “incorrect” lengths of strings with unicode pairs - each unicode pair is counted as two characters.</li>
<li><em>nullable</em>: support keyword “nullable” from <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://swagger.io/docs/specification/data-models/data-types/" >Open API 3 specification</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>.</li>
<li><em>format</em>: formats validation mode. Option values:<ul>
<li><code>&quot;fast&quot;</code> (default) - simplified and fast validation (see <a href="#formats">Formats</a> for details of which formats are available and affected by this option).</li>
<li><code>&quot;full&quot;</code> - more restrictive and slow validation. E.g., 25:00:00 and 2015&#x2F;14&#x2F;33 will be invalid time and date in ‘full’ mode but it will be valid in ‘fast’ mode.</li>
<li><code>false</code> - ignore all format keywords.</li>
</ul>
</li>
<li><em>formats</em>: an object with custom formats. Keys and values will be passed to <code>addFormat</code> method.</li>
<li><em>keywords</em>: an object with custom keywords. Keys and values will be passed to <code>addKeyword</code> method.</li>
<li><em>unknownFormats</em>: handling of unknown formats. Option values:<ul>
<li><code>true</code> (default) - if an unknown format is encountered the exception is thrown during schema compilation. If <code>format</code> keyword value is <a href="#data-reference">$data reference</a> and it is unknown the validation will fail.</li>
<li><code>[String]</code> - an array of unknown format names that will be ignored. This option can be used to allow usage of third party schemas with format(s) for which you don’t have definitions, but still fail if another unknown format is used. If <code>format</code> keyword value is <a href="#data-reference">$data reference</a> and it is not in this array the validation will fail.</li>
<li><code>&quot;ignore&quot;</code> - to log warning during schema compilation and always pass validation (the default behaviour in versions before 5.0.0). This option is not recommended, as it allows to mistype format name and it won’t be validated without any error message. This behaviour is required by JSON Schema specification.</li>
</ul>
</li>
<li><em>schemas</em>: an array or object of schemas that will be added to the instance. In case you pass the array the schemas must have IDs in them. When the object is passed the method <code>addSchema(value, key)</code> will be called for each schema in this object.</li>
<li><em>logger</em>: sets the logging method. Default is the global <code>console</code> object that should have methods <code>log</code>, <code>warn</code> and <code>error</code>. See <a href="#error-logging">Error logging</a>. Option values:<ul>
<li>custom logger - it should have methods <code>log</code>, <code>warn</code> and <code>error</code>. If any of these methods is missing an exception will be thrown.</li>
<li><code>false</code> - logging is disabled.</li>
</ul>
</li>
</ul>

        <h5 id="Referenced-schema-options"   >
          <a href="#Referenced-schema-options" class="heading-link"><i class="fas fa-link"></i></a><a href="#Referenced-schema-options" class="headerlink" title="Referenced schema options"></a>Referenced schema options</h5>
      <ul>
<li><em>schemaId</em>: this option defines which keywords are used as schema URI. Option value:<ul>
<li><code>&quot;$id&quot;</code> (default) - only use <code>$id</code> keyword as schema URI (as specified in JSON Schema draft-06&#x2F;07), ignore <code>id</code> keyword (if it is present a warning will be logged).</li>
<li><code>&quot;id&quot;</code> - only use <code>id</code> keyword as schema URI (as specified in JSON Schema draft-04), ignore <code>$id</code> keyword (if it is present a warning will be logged).</li>
<li><code>&quot;auto&quot;</code> - use both <code>$id</code> and <code>id</code> keywords as schema URI. If both are present (in the same schema object) and different the exception will be thrown during schema compilation.</li>
</ul>
</li>
<li><em>missingRefs</em>: handling of missing referenced schemas. Option values:<ul>
<li><code>true</code> (default) - if the reference cannot be resolved during compilation the exception is thrown. The thrown error has properties <code>missingRef</code> (with hash fragment) and <code>missingSchema</code> (without it). Both properties are resolved relative to the current base id (usually schema id, unless it was substituted).</li>
<li><code>&quot;ignore&quot;</code> - to log error during compilation and always pass validation.</li>
<li><code>&quot;fail&quot;</code> - to log error and successfully compile schema but fail validation if this rule is checked.</li>
</ul>
</li>
<li><em>extendRefs</em>: validation of other keywords when <code>$ref</code> is present in the schema. Option values:<ul>
<li><code>&quot;ignore&quot;</code> (default) - when <code>$ref</code> is used other keywords are ignored (as per <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://tools.ietf.org/html/draft-pbryan-zyp-json-ref-03#section-3" >JSON Reference</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> standard). A warning will be logged during the schema compilation.</li>
<li><code>&quot;fail&quot;</code> (recommended) - if other validation keywords are used together with <code>$ref</code> the exception will be thrown when the schema is compiled. This option is recommended to make sure schema has no keywords that are ignored, which can be confusing.</li>
<li><code>true</code> - validate all keywords in the schemas with <code>$ref</code> (the default behaviour in versions before 5.0.0).</li>
</ul>
</li>
<li><em>loadSchema</em>: asynchronous function that will be used to load remote schemas when <code>compileAsync</code> <a href="#api-compileAsync">method</a> is used and some reference is missing (option <code>missingRefs</code> should NOT be ‘fail’ or ‘ignore’). This function should accept remote schema uri as a parameter and return a Promise that resolves to a schema. See example in <a href="#asynchronous-schema-compilation">Asynchronous compilation</a>.</li>
</ul>

        <h5 id="Options-to-modify-validated-data"   >
          <a href="#Options-to-modify-validated-data" class="heading-link"><i class="fas fa-link"></i></a><a href="#Options-to-modify-validated-data" class="headerlink" title="Options to modify validated data"></a>Options to modify validated data</h5>
      <ul>
<li><em>removeAdditional</em>: remove additional properties - see example in <a href="#filtering-data">Filtering data</a>. This option is not used if schema is added with <code>addMetaSchema</code> method. Option values:<ul>
<li><code>false</code> (default) - not to remove additional properties</li>
<li><code>&quot;all&quot;</code> - all additional properties are removed, regardless of <code>additionalProperties</code> keyword in schema (and no validation is made for them).</li>
<li><code>true</code> - only additional properties with <code>additionalProperties</code> keyword equal to <code>false</code> are removed.</li>
<li><code>&quot;failing&quot;</code> - additional properties that fail schema validation will be removed (where <code>additionalProperties</code> keyword is <code>false</code> or schema).</li>
</ul>
</li>
<li><em>useDefaults</em>: replace missing or undefined properties and items with the values from corresponding <code>default</code> keywords. Default behaviour is to ignore <code>default</code> keywords. This option is not used if schema is added with <code>addMetaSchema</code> method. See examples in <a href="#assigning-defaults">Assigning defaults</a>. Option values:<ul>
<li><code>false</code> (default) - do not use defaults</li>
<li><code>true</code> - insert defaults by value (object literal is used).</li>
<li><code>&quot;empty&quot;</code> - in addition to missing or undefined, use defaults for properties and items that are equal to <code>null</code> or <code>&quot;&quot;</code> (an empty string).</li>
<li><code>&quot;shared&quot;</code> (deprecated) - insert defaults by reference. If the default is an object, it will be shared by all instances of validated data. If you modify the inserted default in the validated data, it will be modified in the schema as well.</li>
</ul>
</li>
<li><em>coerceTypes</em>: change data type of data to match <code>type</code> keyword. See the example in <a href="#coercing-data-types">Coercing data types</a> and <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/blob/master/COERCION.md" >coercion rules</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>. Option values:<ul>
<li><code>false</code> (default) - no type coercion.</li>
<li><code>true</code> - coerce scalar data types.</li>
<li><code>&quot;array&quot;</code> - in addition to coercions between scalar types, coerce scalar data to an array with one element and vice versa (as required by the schema).</li>
</ul>
</li>
</ul>

        <h5 id="Strict-mode-options"   >
          <a href="#Strict-mode-options" class="heading-link"><i class="fas fa-link"></i></a><a href="#Strict-mode-options" class="headerlink" title="Strict mode options"></a>Strict mode options</h5>
      <ul>
<li><em>strictDefaults</em>: report ignored <code>default</code> keywords in schemas. Option values:<ul>
<li><code>false</code> (default) - ignored defaults are not reported</li>
<li><code>true</code> - if an ignored default is present, throw an error</li>
<li><code>&quot;log&quot;</code> - if an ignored default is present, log warning</li>
</ul>
</li>
<li><em>strictKeywords</em>: report unknown keywords in schemas. Option values:<ul>
<li><code>false</code> (default) - unknown keywords are not reported</li>
<li><code>true</code> - if an unknown keyword is present, throw an error</li>
<li><code>&quot;log&quot;</code> - if an unknown keyword is present, log warning</li>
</ul>
</li>
<li><em>strictNumbers</em>: validate numbers strictly, failing validation for NaN and Infinity. Option values:<ul>
<li><code>false</code> (default) - NaN or Infinity will pass validation for numeric types</li>
<li><code>true</code> - NaN or Infinity will not pass validation for numeric types</li>
</ul>
</li>
</ul>

        <h5 id="Asynchronous-validation-options"   >
          <a href="#Asynchronous-validation-options" class="heading-link"><i class="fas fa-link"></i></a><a href="#Asynchronous-validation-options" class="headerlink" title="Asynchronous validation options"></a>Asynchronous validation options</h5>
      <ul>
<li><em>transpile</em>: Requires <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv-async" >ajv-async</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> package. It determines whether Ajv transpiles compiled asynchronous validation function. Option values:<ul>
<li><code>undefined</code> (default) - transpile with <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/MatAtBread/nodent" >nodent</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> if async functions are not supported.</li>
<li><code>true</code> - always transpile with nodent.</li>
<li><code>false</code> - do not transpile; if async functions are not supported an exception will be thrown.</li>
</ul>
</li>
</ul>

        <h5 id="Advanced-options"   >
          <a href="#Advanced-options" class="heading-link"><i class="fas fa-link"></i></a><a href="#Advanced-options" class="headerlink" title="Advanced options"></a>Advanced options</h5>
      <ul>
<li><em>meta</em>: add <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://json-schema.org/documentation.html" >meta-schema</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> so it can be used by other schemas (true by default). If an object is passed, it will be used as the default meta-schema for schemas that have no <code>$schema</code> keyword. This default meta-schema MUST have <code>$schema</code> keyword.</li>
<li><em>validateSchema</em>: validate added&#x2F;compiled schemas against meta-schema (true by default). <code>$schema</code> property in the schema can be <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://json-schema.org/draft-07/schema" >http://json-schema.org/draft-07/schema</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> or absent (draft-07 meta-schema will be used) or can be a reference to the schema previously added with <code>addMetaSchema</code> method. Option values:<ul>
<li><code>true</code> (default) -  if the validation fails, throw the exception.</li>
<li><code>&quot;log&quot;</code> - if the validation fails, log error.</li>
<li><code>false</code> - skip schema validation.</li>
</ul>
</li>
<li><em>addUsedSchema</em>: by default methods <code>compile</code> and <code>validate</code> add schemas to the instance if they have <code>$id</code> (or <code>id</code>) property that doesn’t start with “#”. If <code>$id</code> is present and it is not unique the exception will be thrown. Set this option to <code>false</code> to skip adding schemas to the instance and the <code>$id</code> uniqueness check when these methods are used. This option does not affect <code>addSchema</code> method.</li>
<li><em>inlineRefs</em>: Affects compilation of referenced schemas. Option values:<ul>
<li><code>true</code> (default) - the referenced schemas that don’t have refs in them are inlined, regardless of their size - that substantially improves performance at the cost of the bigger size of compiled schema functions.</li>
<li><code>false</code> - to not inline referenced schemas (they will be compiled as separate functions).</li>
<li>integer number - to limit the maximum number of keywords of the schema that will be inlined.</li>
</ul>
</li>
<li><em>passContext</em>: pass validation context to custom keyword functions. If this option is <code>true</code> and you pass some context to the compiled validation function with <code>validate.call(context, data)</code>, the <code>context</code> will be available as <code>this</code> in your custom keywords. By default <code>this</code> is Ajv instance.</li>
<li><em>loopRequired</em>: by default <code>required</code> keyword is compiled into a single expression (or a sequence of statements in <code>allErrors</code> mode). In case of a very large number of properties in this keyword it may result in a very big validation function. Pass integer to set the number of properties above which <code>required</code> keyword will be validated in a loop - smaller validation function size but also worse performance.</li>
<li><em>ownProperties</em>: by default Ajv iterates over all enumerable object properties; when this option is <code>true</code> only own enumerable object properties (i.e. found directly on the object rather than on its prototype) are iterated. Contributed by @mbroadst.</li>
<li><em>multipleOfPrecision</em>: by default <code>multipleOf</code> keyword is validated by comparing the result of division with parseInt() of that result. It works for dividers that are bigger than 1. For small dividers such as 0.01 the result of the division is usually not integer (even when it should be integer, see issue <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/issues/84" >#84</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>). If you need to use fractional dividers set this option to some positive integer N to have <code>multipleOf</code> validated using this formula: <code>Math.abs(Math.round(division) - division) &lt; 1e-N</code> (it is slower but allows for float arithmetics deviations).</li>
<li><em>errorDataPath</em> (deprecated): set <code>dataPath</code> to point to ‘object’ (default) or to ‘property’ when validating keywords <code>required</code>, <code>additionalProperties</code> and <code>dependencies</code>.</li>
<li><em>messages</em>: Include human-readable messages in errors. <code>true</code> by default. <code>false</code> can be passed when custom messages are used (e.g. with <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv-i18n" >ajv-i18n</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>).</li>
<li><em>sourceCode</em>: add <code>sourceCode</code> property to validating function (for debugging; this code can be different from the result of toString call).</li>
<li><em>processCode</em>: an optional function to process generated code before it is passed to Function constructor. It can be used to either beautify (the validating function is generated without line-breaks) or to transpile code. Starting from version 5.0.0 this option replaced options:<ul>
<li><code>beautify</code> that formatted the generated function using <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/beautify-web/js-beautify" >js-beautify</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>. If you want to beautify the generated code pass a function calling <code>require(&#39;js-beautify&#39;).js_beautify</code> as <code>processCode: code =&gt; js_beautify(code)</code>.</li>
<li><code>transpile</code> that transpiled asynchronous validation function. You can still use <code>transpile</code> option with <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv-async" >ajv-async</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> package. See <a href="#asynchronous-validation">Asynchronous validation</a> for more information.</li>
</ul>
</li>
<li><em>cache</em>: an optional instance of cache to store compiled schemas using stable-stringified schema as a key. For example, set-associative cache <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/epoberezkin/sacjs" >sacjs</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> can be used. If not passed then a simple hash is used which is good enough for the common use case (a limited number of statically defined schemas). Cache should have methods <code>put(key, value)</code>, <code>get(key)</code>, <code>del(key)</code> and <code>clear()</code>.</li>
<li><em>serialize</em>: an optional function to serialize schema to cache key. Pass <code>false</code> to use schema itself as a key (e.g., if WeakMap used as a cache). By default <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/epoberezkin/fast-json-stable-stringify" >fast-json-stable-stringify</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> is used.</li>
</ul>

        <h2 id="Validation-errors"   >
          <a href="#Validation-errors" class="heading-link"><i class="fas fa-link"></i></a><a href="#Validation-errors" class="headerlink" title="Validation errors"></a>Validation errors</h2>
      <p>In case of validation failure, Ajv assigns the array of errors to <code>errors</code> property of validation function (or to <code>errors</code> property of Ajv instance when <code>validate</code> or <code>validateSchema</code> methods were called). In case of <a href="#asynchronous-validation">asynchronous validation</a>, the returned promise is rejected with exception <code>Ajv.ValidationError</code> that has <code>errors</code> property.</p>

        <h3 id="Error-objects"   >
          <a href="#Error-objects" class="heading-link"><i class="fas fa-link"></i></a><a href="#Error-objects" class="headerlink" title="Error objects"></a>Error objects</h3>
      <p>Each error is an object with the following properties:</p>
<ul>
<li><em>keyword</em>: validation keyword.</li>
<li><em>dataPath</em>: the path to the part of the data that was validated. By default <code>dataPath</code> uses JavaScript property access notation (e.g., <code>&quot;.prop[1].subProp&quot;</code>). When the option <code>jsonPointers</code> is true (see <a href="#options">Options</a>) <code>dataPath</code> will be set using JSON pointer standard (e.g., <code>&quot;/prop/1/subProp&quot;</code>).</li>
<li><em>schemaPath</em>: the path (JSON-pointer as a URI fragment) to the schema of the keyword that failed validation.</li>
<li><em>params</em>: the object with the additional information about error that can be used to create custom error messages (e.g., using <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv-i18n" >ajv-i18n</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> package). See below for parameters set by all keywords.</li>
<li><em>message</em>: the standard error message (can be excluded with option <code>messages</code> set to false).</li>
<li><em>schema</em>: the schema of the keyword (added with <code>verbose</code> option).</li>
<li><em>parentSchema</em>: the schema containing the keyword (added with <code>verbose</code> option)</li>
<li><em>data</em>: the data validated by the keyword (added with <code>verbose</code> option).</li>
</ul>
<p><strong>Please note</strong>: <code>propertyNames</code> keyword schema validation errors have an additional property <code>propertyName</code>, <code>dataPath</code> points to the object. After schema validation for each property name, if it is invalid an additional error is added with the property <code>keyword</code> equal to <code>&quot;propertyNames&quot;</code>.</p>

        <h3 id="Error-parameters"   >
          <a href="#Error-parameters" class="heading-link"><i class="fas fa-link"></i></a><a href="#Error-parameters" class="headerlink" title="Error parameters"></a>Error parameters</h3>
      <p>Properties of <code>params</code> object in errors depend on the keyword that failed validation.</p>
<ul>
<li><code>maxItems</code>, <code>minItems</code>, <code>maxLength</code>, <code>minLength</code>, <code>maxProperties</code>, <code>minProperties</code> - property <code>limit</code> (number, the schema of the keyword).</li>
<li><code>additionalItems</code> - property <code>limit</code> (the maximum number of allowed items in case when <code>items</code> keyword is an array of schemas and <code>additionalItems</code> is false).</li>
<li><code>additionalProperties</code> - property <code>additionalProperty</code> (the property not used in <code>properties</code> and <code>patternProperties</code> keywords).</li>
<li><code>dependencies</code> - properties:<ul>
<li><code>property</code> (dependent property),</li>
<li><code>missingProperty</code> (required missing dependency - only the first one is reported currently)</li>
<li><code>deps</code> (required dependencies, comma separated list as a string),</li>
<li><code>depsCount</code> (the number of required dependencies).</li>
</ul>
</li>
<li><code>format</code> - property <code>format</code> (the schema of the keyword).</li>
<li><code>maximum</code>, <code>minimum</code> - properties:<ul>
<li><code>limit</code> (number, the schema of the keyword),</li>
<li><code>exclusive</code> (boolean, the schema of <code>exclusiveMaximum</code> or <code>exclusiveMinimum</code>),</li>
<li><code>comparison</code> (string, comparison operation to compare the data to the limit, with the data on the left and the limit on the right; can be “&lt;”, “&lt;&#x3D;”, “&gt;”, “&gt;&#x3D;”)</li>
</ul>
</li>
<li><code>multipleOf</code> - property <code>multipleOf</code> (the schema of the keyword)</li>
<li><code>pattern</code> - property <code>pattern</code> (the schema of the keyword)</li>
<li><code>required</code> - property <code>missingProperty</code> (required property that is missing).</li>
<li><code>propertyNames</code> - property <code>propertyName</code> (an invalid property name).</li>
<li><code>patternRequired</code> (in ajv-keywords) - property <code>missingPattern</code> (required pattern that did not match any property).</li>
<li><code>type</code> - property <code>type</code> (required type(s), a string, can be a comma-separated list)</li>
<li><code>uniqueItems</code> - properties <code>i</code> and <code>j</code> (indices of duplicate items).</li>
<li><code>const</code> - property <code>allowedValue</code> pointing to the value (the schema of the keyword).</li>
<li><code>enum</code> - property <code>allowedValues</code> pointing to the array of values (the schema of the keyword).</li>
<li><code>$ref</code> - property <code>ref</code> with the referenced schema URI.</li>
<li><code>oneOf</code> - property <code>passingSchemas</code> (array of indices of passing schemas, null if no schema passes).</li>
<li>custom keywords (in case keyword definition doesn’t create errors) - property <code>keyword</code> (the keyword name).</li>
</ul>

        <h3 id="Error-logging"   >
          <a href="#Error-logging" class="heading-link"><i class="fas fa-link"></i></a><a href="#Error-logging" class="headerlink" title="Error logging"></a>Error logging</h3>
      <p>Using the <code>logger</code> option when initiallizing Ajv will allow you to define custom logging. Here you can build upon the exisiting logging. The use of other logging packages is supported as long as the package or its associated wrapper exposes the required methods. If any of the required methods are missing an exception will be thrown.</p>
<ul>
<li><strong>Required Methods</strong>: <code>log</code>, <code>warn</code>, <code>error</code></li>
</ul>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> otherLogger = <span class="keyword">new</span> <span class="title class_">OtherLogger</span>();</span><br><span class="line"><span class="keyword">var</span> ajv = <span class="keyword">new</span> <span class="title class_">Ajv</span>(&#123;</span><br><span class="line">  <span class="attr">logger</span>: &#123;</span><br><span class="line">    <span class="attr">log</span>: <span class="variable language_">console</span>.<span class="property">log</span>.<span class="title function_">bind</span>(<span class="variable language_">console</span>),</span><br><span class="line">    <span class="attr">warn</span>: <span class="keyword">function</span> <span class="title function_">warn</span>(<span class="params"></span>) &#123;</span><br><span class="line">      otherLogger.<span class="property">logWarn</span>.<span class="title function_">apply</span>(otherLogger, <span class="variable language_">arguments</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">error</span>: <span class="keyword">function</span> <span class="title function_">error</span>(<span class="params"></span>) &#123;</span><br><span class="line">      otherLogger.<span class="property">logError</span>.<span class="title function_">apply</span>(otherLogger, <span class="variable language_">arguments</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="property">error</span>.<span class="title function_">apply</span>(<span class="variable language_">console</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></div></figure>



        <h2 id="Plugins"   >
          <a href="#Plugins" class="heading-link"><i class="fas fa-link"></i></a><a href="#Plugins" class="headerlink" title="Plugins"></a>Plugins</h2>
      <p>Ajv can be extended with plugins that add custom keywords, formats or functions to process generated code. When such plugin is published as npm package it is recommended that it follows these conventions:</p>
<ul>
<li>it exports a function</li>
<li>this function accepts ajv instance as the first parameter and returns the same instance to allow chaining</li>
<li>this function can accept an optional configuration as the second parameter</li>
</ul>
<p>If you have published a useful plugin please submit a PR to add it to the next section.</p>

        <h2 id="Related-packages"   >
          <a href="#Related-packages" class="heading-link"><i class="fas fa-link"></i></a><a href="#Related-packages" class="headerlink" title="Related packages"></a>Related packages</h2>
      <ul>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv-async" >ajv-async</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - plugin to configure async validation mode</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/BoLaMN/ajv-bsontype" >ajv-bsontype</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - plugin to validate mongodb’s bsonType formats</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/jessedc/ajv-cli" >ajv-cli</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - command line interface</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv-errors" >ajv-errors</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - plugin for custom error messages</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv-i18n" >ajv-i18n</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - internationalised error messages</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv-istanbul" >ajv-istanbul</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - plugin to instrument generated validation code to measure test coverage of your schemas</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv-keywords" >ajv-keywords</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - plugin with custom validation keywords (select, typeof, etc.)</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv-merge-patch" >ajv-merge-patch</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - plugin with keywords $merge and $patch</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv-pack" >ajv-pack</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - produces a compact module exporting validation functions</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/luzlab/ajv-formats-draft2019" >ajv-formats-draft2019</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - format validators for draft2019 that aren’t already included in ajv (ie. <code>idn-hostname</code>, <code>idn-email</code>, <code>iri</code>, <code>iri-reference</code> and <code>duration</code>).</li>
</ul>

        <h2 id="Some-packages-using-Ajv"   >
          <a href="#Some-packages-using-Ajv" class="heading-link"><i class="fas fa-link"></i></a><a href="#Some-packages-using-Ajv" class="headerlink" title="Some packages using Ajv"></a>Some packages using Ajv</h2>
      <ul>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/webpack/webpack" >webpack</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - a module bundler. Its main purpose is to bundle JavaScript files for usage in a browser</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/JSONScript/jsonscript-js" >jsonscript-js</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - the interpreter for <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://www.jsonscript.org/" >JSONScript</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - scripted processing of existing endpoints and services</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/mulesoft-labs/osprey-method-handler" >osprey-method-handler</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - Express middleware for validating requests and responses based on a RAML method object, used in <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/mulesoft/osprey" >osprey</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - validating API proxy generated from a RAML definition</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ahmadnassri/har-validator" >har-validator</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - HTTP Archive (HAR) validator</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/josdejong/jsoneditor" >jsoneditor</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - a web-based tool to view, edit, format, and validate JSON <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://jsoneditoronline.org/" >http://jsoneditoronline.org</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/nickcmaynard/jsonschemalint" >JSON Schema Lint</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - a web tool to validate JSON&#x2F;YAML document against a single JSON Schema <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://jsonschemalint.com/" >http://jsonschemalint.com</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/vincit/objection.js" >objection</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - SQL-friendly ORM for Node.js</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/gajus/table" >table</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - formats data into a string table</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ripple/ripple-lib" >ripple-lib</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - a JavaScript API for interacting with <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://ripple.com/" >Ripple</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> in Node.js and the browser</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/wikimedia/restbase" >restbase</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - distributed storage with REST API &amp; dispatcher for backend services built to provide a low-latency &amp; high-throughput API for Wikipedia &#x2F; Wikimedia content</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/CacheControl/hippie-swagger" >hippie-swagger</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/vesln/hippie" >Hippie</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> wrapper that provides end to end API testing with swagger validation</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/seeden/react-form-controlled" >react-form-controlled</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - React controlled form components with validation</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/tjmehta/rabbitmq-schema" >rabbitmq-schema</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - a schema definition module for RabbitMQ graphs and messages</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.npmjs.com/package/@query/schema" >@query&#x2F;schema</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - stream filtering with a URI-safe query syntax parsing to JSON Schema</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/peon374/chai-ajv-json-schema" >chai-ajv-json-schema</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - chai plugin to us JSON Schema with expect in mocha tests</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/SignpostMarv/grunt-jsonschema-ajv" >grunt-jsonschema-ajv</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - Grunt plugin for validating files against JSON Schema</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/webpack-contrib/extract-text-webpack-plugin" >extract-text-webpack-plugin</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - extract text from bundle into a file</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/electron-userland/electron-builder" >electron-builder</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - a solution to package and build a ready for distribution Electron app</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/mozilla/addons-linter" >addons-linter</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - Mozilla Add-ons Linter</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/epoberezkin/gh-pages-generator" >gh-pages-generator</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - multi-page site generator converting markdown files to GitHub pages</li>
<li><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/eslint/eslint" >ESLint</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - the pluggable linting utility for JavaScript and JSX</li>
</ul>

        <h2 id="Tests"   >
          <a href="#Tests" class="heading-link"><i class="fas fa-link"></i></a><a href="#Tests" class="headerlink" title="Tests"></a>Tests</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br><span class="line">git submodule update --init</span><br><span class="line">npm test</span><br></pre></td></tr></table></div></figure>


        <h2 id="Contributing"   >
          <a href="#Contributing" class="heading-link"><i class="fas fa-link"></i></a><a href="#Contributing" class="headerlink" title="Contributing"></a>Contributing</h2>
      <p>All validation functions are generated using doT templates in <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/tree/master/lib/dot" >dot</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> folder. Templates are precompiled so doT is not a run-time dependency.</p>
<p><code>npm run build</code> - compiles templates to <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/tree/master/lib/dotjs" >dotjs</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> folder.</p>
<p><code>npm run watch</code> - automatically compiles templates when files in dot folder change</p>
<p>Please see <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/blob/master/CONTRIBUTING.md" >Contributing guidelines</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="Changes-history"   >
          <a href="#Changes-history" class="heading-link"><i class="fas fa-link"></i></a><a href="#Changes-history" class="headerlink" title="Changes history"></a>Changes history</h2>
      <p>See <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/releases" >https://github.com/ajv-validator/ajv/releases</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><strong>Please note</strong>: <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/releases/tag/v7.0.0-beta.0" >Changes in version 7.0.0-beta</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/releases/tag/v6.0.0" >Version 6.0.0</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>.</p>

        <h2 id="Code-of-conduct"   >
          <a href="#Code-of-conduct" class="heading-link"><i class="fas fa-link"></i></a><a href="#Code-of-conduct" class="headerlink" title="Code of conduct"></a>Code of conduct</h2>
      <p>Please review and follow the <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/blob/master/CODE_OF_CONDUCT.md" >Code of conduct</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>.</p>
<p>Please report any unacceptable behaviour to <span class="exturl"><a class="exturl__link"   href="mailto:&#x61;&#106;&#118;&#46;&#118;&#x61;&#108;&#105;&#x64;&#97;&#x74;&#111;&#x72;&#x40;&#103;&#x6d;&#97;&#x69;&#108;&#x2e;&#99;&#111;&#x6d;" >&#x61;&#106;&#118;&#46;&#118;&#x61;&#108;&#105;&#x64;&#97;&#x74;&#111;&#x72;&#x40;&#103;&#x6d;&#97;&#x69;&#108;&#x2e;&#99;&#111;&#x6d;</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - it will be reviewed by the project team.</p>

        <h2 id="Open-source-software-support"   >
          <a href="#Open-source-software-support" class="heading-link"><i class="fas fa-link"></i></a><a href="#Open-source-software-support" class="headerlink" title="Open-source software support"></a>Open-source software support</h2>
      <p>Ajv is a part of <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://tidelift.com/subscription/pkg/npm-ajv?utm_source=npm-ajv&utm_medium=referral&utm_campaign=readme" >Tidelift subscription</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> - it provides a centralised support to open-source software users, in addition to the support provided by software maintainers.</p>

        <h2 id="License"   >
          <a href="#License" class="heading-link"><i class="fas fa-link"></i></a><a href="#License" class="headerlink" title="License"></a>License</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/ajv-validator/ajv/blob/master/LICENSE" >MIT</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/03/24/02_%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/01_%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8-demo/node_modules/acorn-walk/README/">[ Untitled ]</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2023-03-24</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">1985-10-26</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="Acorn-AST-walker"   >
          <a href="#Acorn-AST-walker" class="heading-link"><i class="fas fa-link"></i></a><a href="#Acorn-AST-walker" class="headerlink" title="Acorn AST walker"></a>Acorn AST walker</h1>
      <p>An abstract syntax tree walker for the<br><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/estree/estree" >ESTree</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> format.</p>

        <h2 id="Community"   >
          <a href="#Community" class="heading-link"><i class="fas fa-link"></i></a><a href="#Community" class="headerlink" title="Community"></a>Community</h2>
      <p>Acorn is open source software released under an<br><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/acornjs/acorn/blob/master/acorn-walk/LICENSE" >MIT license</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>.</p>
<p>You are welcome to<br><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/acornjs/acorn/issues" >report bugs</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> or create pull<br>requests on <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/acornjs/acorn" >github</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>. For questions<br>and discussion, please use the<br><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://discuss.ternjs.net/" >Tern discussion forum</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>.</p>

        <h2 id="Installation"   >
          <a href="#Installation" class="heading-link"><i class="fas fa-link"></i></a><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2>
      <p>The easiest way to install acorn is from <a target="_blank" rel="noopener" href="https://www.npmjs.com/"><code>npm</code></a>:</p>
<figure class="highlight sh"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install acorn-walk</span><br></pre></td></tr></table></div></figure>

<p>Alternately, you can download the source and build acorn yourself:</p>
<figure class="highlight sh"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/acornjs/acorn.git</span><br><span class="line"><span class="built_in">cd</span> acorn</span><br><span class="line">npm install</span><br></pre></td></tr></table></div></figure>


        <h2 id="Interface"   >
          <a href="#Interface" class="heading-link"><i class="fas fa-link"></i></a><a href="#Interface" class="headerlink" title="Interface"></a>Interface</h2>
      <p>An algorithm for recursing through a syntax tree is stored as an<br>object, with a property for each tree node type holding a function<br>that will recurse through such a node. There are several ways to run<br>such a walker.</p>
<p><strong>simple</strong><code>(node, visitors, base, state)</code> does a ‘simple’ walk over a<br>tree. <code>node</code> should be the AST node to walk, and <code>visitors</code> an object<br>with properties whose names correspond to node types in the <a target="_blank" rel="noopener" href="https://github.com/estree/estree">ESTree<br>spec</a>. The properties should contain<br>functions that will be called with the node object and, if applicable<br>the state at that point. The last two arguments are optional. <code>base</code><br>is a walker algorithm, and <code>state</code> is a start state. The default<br>walker will simply visit all statements and expressions and not<br>produce a meaningful state. (An example of a use of state is to track<br>scope at each point in the tree.)</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> acorn = <span class="built_in">require</span>(<span class="string">&quot;acorn&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> walk = <span class="built_in">require</span>(<span class="string">&quot;acorn-walk&quot;</span>)</span><br><span class="line"></span><br><span class="line">walk.<span class="title function_">simple</span>(acorn.<span class="title function_">parse</span>(<span class="string">&quot;let x = 10&quot;</span>), &#123;</span><br><span class="line">  <span class="title class_">Literal</span>(node) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Found a literal: <span class="subst">$&#123;node.value&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></div></figure>

<p><strong>ancestor</strong><code>(node, visitors, base, state)</code> does a ‘simple’ walk over<br>a tree, building up an array of ancestor nodes (including the current node)<br>and passing the array to the callbacks as a third parameter.</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> acorn = <span class="built_in">require</span>(<span class="string">&quot;acorn&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> walk = <span class="built_in">require</span>(<span class="string">&quot;acorn-walk&quot;</span>)</span><br><span class="line"></span><br><span class="line">walk.<span class="title function_">ancestor</span>(acorn.<span class="title function_">parse</span>(<span class="string">&quot;foo(&#x27;hi&#x27;)&quot;</span>), &#123;</span><br><span class="line">  <span class="title class_">Literal</span>(_, ancestors) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;This literal&#x27;s ancestors are:&quot;</span>, ancestors.<span class="title function_">map</span>(<span class="function"><span class="params">n</span> =&gt;</span> n.<span class="property">type</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></div></figure>

<p><strong>recursive</strong><code>(node, state, functions, base)</code> does a ‘recursive’<br>walk, where the walker functions are responsible for continuing the<br>walk on the child nodes of their target node. <code>state</code> is the start<br>state, and <code>functions</code> should contain an object that maps node types<br>to walker functions. Such functions are called with <code>(node, state, c)</code><br>arguments, and can cause the walk to continue on a sub-node by calling<br>the <code>c</code> argument on it with <code>(node, state)</code> arguments. The optional<br><code>base</code> argument provides the fallback walker functions for node types<br>that aren’t handled in the <code>functions</code> object. If not given, the<br>default walkers will be used.</p>
<p><strong>make</strong><code>(functions, base)</code> builds a new walker object by using the<br>walker functions in <code>functions</code> and filling in the missing ones by<br>taking defaults from <code>base</code>.</p>
<p><strong>full</strong><code>(node, callback, base, state)</code> does a ‘full’ walk over a<br>tree, calling the callback with the arguments (node, state, type) for<br>each node</p>
<p><strong>fullAncestor</strong><code>(node, callback, base, state)</code> does a ‘full’ walk<br>over a tree, building up an array of ancestor nodes (including the<br>current node) and passing the array to the callbacks as a third<br>parameter.</p>
<figure class="highlight js"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> acorn = <span class="built_in">require</span>(<span class="string">&quot;acorn&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> walk = <span class="built_in">require</span>(<span class="string">&quot;acorn-walk&quot;</span>)</span><br><span class="line"></span><br><span class="line">walk.<span class="title function_">full</span>(acorn.<span class="title function_">parse</span>(<span class="string">&quot;1 + 1&quot;</span>), <span class="function"><span class="params">node</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`There&#x27;s a <span class="subst">$&#123;node.type&#125;</span> node at <span class="subst">$&#123;node.ch&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></div></figure>

<p><strong>findNodeAt</strong><code>(node, start, end, test, base, state)</code> tries to locate<br>a node in a tree at the given start and&#x2F;or end offsets, which<br>satisfies the predicate <code>test</code>. <code>start</code> and <code>end</code> can be either <code>null</code><br>(as wildcard) or a number. <code>test</code> may be a string (indicating a node<br>type) or a function that takes <code>(nodeType, node)</code> arguments and<br>returns a boolean indicating whether this node is interesting. <code>base</code><br>and <code>state</code> are optional, and can be used to specify a custom walker.<br>Nodes are tested from inner to outer, so if two nodes match the<br>boundaries, the inner one will be preferred.</p>
<p><strong>findNodeAround</strong><code>(node, pos, test, base, state)</code> is a lot like<br><code>findNodeAt</code>, but will match any node that exists ‘around’ (spanning)<br>the given position.</p>
<p><strong>findNodeAfter</strong><code>(node, pos, test, base, state)</code> is similar to<br><code>findNodeAround</code>, but will match all nodes <em>after</em> the given position<br>(testing outer nodes before inner nodes).</p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/03/24/02_%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/01_%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8-demo/node_modules/acorn-walk/CHANGELOG/">[ Untitled ]</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2023-03-24</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">1985-10-26</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h2 id="7-2-0-2020-06-17"   >
          <a href="#7-2-0-2020-06-17" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-2-0-2020-06-17" class="headerlink" title="7.2.0 (2020-06-17)"></a>7.2.0 (2020-06-17)</h2>
      
        <h3 id="New-features"   >
          <a href="#New-features" class="heading-link"><i class="fas fa-link"></i></a><a href="#New-features" class="headerlink" title="New features"></a>New features</h3>
      <p>Support optional chaining and nullish coalescing.</p>
<p>Support <code>import.meta</code>.</p>
<p>Add support for <code>export * as ns from &quot;source&quot;</code>.</p>

        <h2 id="7-1-1-2020-02-13"   >
          <a href="#7-1-1-2020-02-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-1-1-2020-02-13" class="headerlink" title="7.1.1 (2020-02-13)"></a>7.1.1 (2020-02-13)</h2>
      
        <h3 id="Bug-fixes"   >
          <a href="#Bug-fixes" class="heading-link"><i class="fas fa-link"></i></a><a href="#Bug-fixes" class="headerlink" title="Bug fixes"></a>Bug fixes</h3>
      <p>Clean up the type definitions to actually work well with the main parser.</p>

        <h2 id="7-1-0-2020-02-11"   >
          <a href="#7-1-0-2020-02-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-1-0-2020-02-11" class="headerlink" title="7.1.0 (2020-02-11)"></a>7.1.0 (2020-02-11)</h2>
      
        <h3 id="New-features-1"   >
          <a href="#New-features-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#New-features-1" class="headerlink" title="New features"></a>New features</h3>
      <p>Add a TypeScript definition file for the library.</p>

        <h2 id="7-0-0-2017-08-12"   >
          <a href="#7-0-0-2017-08-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-0-0-2017-08-12" class="headerlink" title="7.0.0 (2017-08-12)"></a>7.0.0 (2017-08-12)</h2>
      
        <h3 id="New-features-2"   >
          <a href="#New-features-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#New-features-2" class="headerlink" title="New features"></a>New features</h3>
      <p>Support walking <code>ImportExpression</code> nodes.</p>

        <h2 id="6-2-0-2017-07-04"   >
          <a href="#6-2-0-2017-07-04" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-2-0-2017-07-04" class="headerlink" title="6.2.0 (2017-07-04)"></a>6.2.0 (2017-07-04)</h2>
      
        <h3 id="New-features-3"   >
          <a href="#New-features-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#New-features-3" class="headerlink" title="New features"></a>New features</h3>
      <p>Add support for <code>Import</code> nodes.</p>

        <h2 id="6-1-0-2018-09-28"   >
          <a href="#6-1-0-2018-09-28" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-1-0-2018-09-28" class="headerlink" title="6.1.0 (2018-09-28)"></a>6.1.0 (2018-09-28)</h2>
      
        <h3 id="New-features-4"   >
          <a href="#New-features-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#New-features-4" class="headerlink" title="New features"></a>New features</h3>
      <p>The walker now walks <code>TemplateElement</code> nodes.</p>

        <h2 id="6-0-1-2018-09-14"   >
          <a href="#6-0-1-2018-09-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-0-1-2018-09-14" class="headerlink" title="6.0.1 (2018-09-14)"></a>6.0.1 (2018-09-14)</h2>
      
        <h3 id="Bug-fixes-1"   >
          <a href="#Bug-fixes-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#Bug-fixes-1" class="headerlink" title="Bug fixes"></a>Bug fixes</h3>
      <p>Fix bad “main” field in package.json.</p>

        <h2 id="6-0-0-2018-09-14"   >
          <a href="#6-0-0-2018-09-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-0-0-2018-09-14" class="headerlink" title="6.0.0 (2018-09-14)"></a>6.0.0 (2018-09-14)</h2>
      
        <h3 id="Breaking-changes"   >
          <a href="#Breaking-changes" class="heading-link"><i class="fas fa-link"></i></a><a href="#Breaking-changes" class="headerlink" title="Breaking changes"></a>Breaking changes</h3>
      <p>This is now a separate package, <code>acorn-walk</code>, rather than part of the main <code>acorn</code> package.</p>
<p>The <code>ScopeBody</code> and <code>ScopeExpression</code> meta-node-types are no longer supported.</p>

        <h2 id="5-7-1-2018-06-15"   >
          <a href="#5-7-1-2018-06-15" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-7-1-2018-06-15" class="headerlink" title="5.7.1 (2018-06-15)"></a>5.7.1 (2018-06-15)</h2>
      
        <h3 id="Bug-fixes-2"   >
          <a href="#Bug-fixes-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#Bug-fixes-2" class="headerlink" title="Bug fixes"></a>Bug fixes</h3>
      <p>Make sure the walker and bin files are rebuilt on release (the previous release didn’t get the up-to-date versions).</p>

        <h2 id="5-7-0-2018-06-15"   >
          <a href="#5-7-0-2018-06-15" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-7-0-2018-06-15" class="headerlink" title="5.7.0 (2018-06-15)"></a>5.7.0 (2018-06-15)</h2>
      
        <h3 id="Bug-fixes-3"   >
          <a href="#Bug-fixes-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#Bug-fixes-3" class="headerlink" title="Bug fixes"></a>Bug fixes</h3>
      <p>Fix crash in walker when walking a binding-less catch node.</p>

        <h2 id="5-6-2-2018-06-05"   >
          <a href="#5-6-2-2018-06-05" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-6-2-2018-06-05" class="headerlink" title="5.6.2 (2018-06-05)"></a>5.6.2 (2018-06-05)</h2>
      
        <h3 id="Bug-fixes-4"   >
          <a href="#Bug-fixes-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#Bug-fixes-4" class="headerlink" title="Bug fixes"></a>Bug fixes</h3>
      <p>In the walker, go back to allowing the <code>baseVisitor</code> argument to be null to default to the default base everywhere.</p>

        <h2 id="5-6-1-2018-06-01"   >
          <a href="#5-6-1-2018-06-01" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-6-1-2018-06-01" class="headerlink" title="5.6.1 (2018-06-01)"></a>5.6.1 (2018-06-01)</h2>
      
        <h3 id="Bug-fixes-5"   >
          <a href="#Bug-fixes-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#Bug-fixes-5" class="headerlink" title="Bug fixes"></a>Bug fixes</h3>
      <p>Fix regression when passing <code>null</code> as fourth argument to <code>walk.recursive</code>.</p>

        <h2 id="5-6-0-2018-05-31"   >
          <a href="#5-6-0-2018-05-31" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-6-0-2018-05-31" class="headerlink" title="5.6.0 (2018-05-31)"></a>5.6.0 (2018-05-31)</h2>
      
        <h3 id="Bug-fixes-6"   >
          <a href="#Bug-fixes-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#Bug-fixes-6" class="headerlink" title="Bug fixes"></a>Bug fixes</h3>
      <p>Fix a bug in the walker that caused a crash when walking an object pattern spread.</p>

        <h2 id="5-5-1-2018-03-06"   >
          <a href="#5-5-1-2018-03-06" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-5-1-2018-03-06" class="headerlink" title="5.5.1 (2018-03-06)"></a>5.5.1 (2018-03-06)</h2>
      
        <h3 id="Bug-fixes-7"   >
          <a href="#Bug-fixes-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#Bug-fixes-7" class="headerlink" title="Bug fixes"></a>Bug fixes</h3>
      <p>Fix regression in walker causing property values in object patterns to be walked as expressions.</p>

        <h2 id="5-5-0-2018-02-27"   >
          <a href="#5-5-0-2018-02-27" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-5-0-2018-02-27" class="headerlink" title="5.5.0 (2018-02-27)"></a>5.5.0 (2018-02-27)</h2>
      
        <h3 id="Bug-fixes-8"   >
          <a href="#Bug-fixes-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#Bug-fixes-8" class="headerlink" title="Bug fixes"></a>Bug fixes</h3>
      <p>Support object spread in the AST walker.</p>

        <h2 id="5-4-1-2018-02-02"   >
          <a href="#5-4-1-2018-02-02" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-4-1-2018-02-02" class="headerlink" title="5.4.1 (2018-02-02)"></a>5.4.1 (2018-02-02)</h2>
      
        <h3 id="Bug-fixes-9"   >
          <a href="#Bug-fixes-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#Bug-fixes-9" class="headerlink" title="Bug fixes"></a>Bug fixes</h3>
      <p>5.4.0 somehow accidentally included an old version of walk.js.</p>

        <h2 id="5-2-0-2017-10-30"   >
          <a href="#5-2-0-2017-10-30" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-2-0-2017-10-30" class="headerlink" title="5.2.0 (2017-10-30)"></a>5.2.0 (2017-10-30)</h2>
      
        <h3 id="Bug-fixes-10"   >
          <a href="#Bug-fixes-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#Bug-fixes-10" class="headerlink" title="Bug fixes"></a>Bug fixes</h3>
      <p>The <code>full</code> and <code>fullAncestor</code> walkers no longer visit nodes multiple times.</p>

        <h2 id="5-1-0-2017-07-05"   >
          <a href="#5-1-0-2017-07-05" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-1-0-2017-07-05" class="headerlink" title="5.1.0 (2017-07-05)"></a>5.1.0 (2017-07-05)</h2>
      
        <h3 id="New-features-5"   >
          <a href="#New-features-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#New-features-5" class="headerlink" title="New features"></a>New features</h3>
      <p>New walker functions <code>full</code> and <code>fullAncestor</code>.</p>

        <h2 id="3-2-0-2016-06-07"   >
          <a href="#3-2-0-2016-06-07" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-2-0-2016-06-07" class="headerlink" title="3.2.0 (2016-06-07)"></a>3.2.0 (2016-06-07)</h2>
      
        <h3 id="New-features-6"   >
          <a href="#New-features-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#New-features-6" class="headerlink" title="New features"></a>New features</h3>
      <p>Make it possible to use <code>visit.ancestor</code> with a walk state.</p>

        <h2 id="3-1-0-2016-04-18"   >
          <a href="#3-1-0-2016-04-18" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-1-0-2016-04-18" class="headerlink" title="3.1.0 (2016-04-18)"></a>3.1.0 (2016-04-18)</h2>
      
        <h3 id="New-features-7"   >
          <a href="#New-features-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#New-features-7" class="headerlink" title="New features"></a>New features</h3>
      <p>The walker now allows defining handlers for <code>CatchClause</code> nodes.</p>

        <h2 id="2-5-2-2015-10-27"   >
          <a href="#2-5-2-2015-10-27" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-5-2-2015-10-27" class="headerlink" title="2.5.2 (2015-10-27)"></a>2.5.2 (2015-10-27)</h2>
      
        <h3 id="Fixes"   >
          <a href="#Fixes" class="heading-link"><i class="fas fa-link"></i></a><a href="#Fixes" class="headerlink" title="Fixes"></a>Fixes</h3>
      <p>Fix bug where the walker walked an exported <code>let</code> statement as an expression.</p>
</div></div></article></section><nav class="paginator"><div class="paginator-inner"><a class="extend prev" rel="prev" href="/page/12/"><i class="fas fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><span class="page-number current">13</span><a class="page-number" href="/page/14/">14</a><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/14/"><i class="fas fa-angle-right"></i></a></div></nav></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><section class="sidebar-toc hide"></section><!-- ov = overview--><section class="sidebar-ov"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/icons/cat.jpg" alt="avatar"></div><p class="sidebar-ov-author__text">Hello Stun</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">144</div><div class="sidebar-ov-state-item__name">Archives</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="Creative Commons" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2023</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>汪汪队</span></div><div><span>Powered by <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a></span><span> v6.3.0</span><span class="footer__devider">|</span><span>Theme - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.8.0</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="/js/utils.js?v=2.8.0"></script><script src="/js/stun-boot.js?v=2.8.0"></script><script src="/js/scroll.js?v=2.8.0"></script><script src="/js/header.js?v=2.8.0"></script><script src="/js/sidebar.js?v=2.8.0"></script></body></html>